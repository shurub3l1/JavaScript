const _0x190839=function(){let e=!0;return function(t,n){let a=e?function(){if(n){let e=n.apply(t,arguments);return n=null,e}}:function(){};return e=!1,a}}(),_0x12e296=_0x190839(this,function(){return _0x12e296.toString().search("(((.+)+)+)+$").toString().constructor(_0x12e296).search("(((.+)+)+)+$")});_0x12e296();let changeLog={"1.0":{description:"Commands Overview.",date:void 0},"2.0":{description:"Auto Commands Sender.",date:void 0},"2.0.1":{description:"Update troop count after applying template.",date:"28/06/2022"},"2.0.2":{description:"Modified same of selected templates.",date:"28/06/2022"},"2.0.3":{description:"Show version.",date:"28/06/2022"},"2.0.4":{description:"Worlds restrictions for coops and multis.",date:"28/06/2022"},"2.1.0":{description:"Set and Read MS from plan.",date:"19/07/2022"},"2.1.1":{description:"New noble templates for non watchtower worlds",date:"08/08/2022"},"2.1.2":{description:"New noble templates for non watchtower worlds",date:"01/10/2022"},"2.1.3":{description:"Allow float numbers on random launch time offset.",date:"01/10/2022"},"2.2.0":{description:"Name of the added plan is the name of the template.",date:"01/10/2022"},"2.3.0":{description:"Show plan on the map.",date:"26/01/2023"},"2.3.1":{description:"Also show source villages on map.",date:"18/03/2023"},"2.3.2":{description:"Improved performance on sorting.",date:"20/03/2023"},"2.3.3":{description:"Show duplicate times.",date:"20/03/2023"},"2.3.4":{description:"Map options menu.",date:"22/03/2023"},"2.3.5":{description:"Allow catapult target.",date:"26/03/2023"},"2.3.6":{description:"Fixed 5 nobles templates.",date:"01/04/2023"},"2.3.7":{description:"5 commands same of selected template.",date:"01/04/2023"},"2.3.8":{description:"Close tab from 10 to 2 seconds.",date:"05/05/2023"},"2.4.0":{description:"Improved background performance",date:"17/05/2023"},"2.4.1":{description:"Bug fix for cats in one nt template",date:"04/06/2023"},"2.4.2":{description:"Bug fix on timings I hope",date:"11/06/2023"},"2.4.3":{description:"Sitter without permission can now use script on accounts that have permission.",date:"19/06/2023"},"2.4.4":{description:"Fix for auto send nobles.",date:"24/06/2023"},"2.4.5":{description:"Fix for non paladin worlds.",date:"09/07/2023"},"2.4.6":{description:"Fix for 5 noble nt templates.",date:"09/07/2023"},"2.5.0":{description:"Automatic timing offset calculation.",date:"16/07/2023"},"2.6.0":{description:"New way of verifying account.",date:"21/07/2023"},"2.6.1":{description:"New 5 nobles selected/rest template.",date:"12/08/2023"},"2.6.2":{description:"Leave spies at home.",date:"19/08/2023"},"2.6.3":{description:"Fix in last update.",date:"22/08/2023"},"2.6.4":{description:"Fix in coordinates with less than 3 digits.",date:"22/09/2023"}},version=Object.keys(changeLog).pop(),randomLaunchTimeOffset=0,autoSendNobles=!0,autoTimingOffset=!0,readMSFromPlan=!1,autoFillNt=!0,autoSendInTime=!0,ntTemplates={splitSecondThirdNobleNT:{name:"Split in 2nd&3rd Noble NT",id:"NT_2ND&3RD_NOBLE_BUFF",fillFunction:"fill2nd3rdNoblesNT",noblesQnt:4,brownNoble:!0,onlyNobles:!0,selected:!1},secondNobleBuffNT:{name:"2nd Noble Buff NT",id:"NT_2ND_NOBLE_BUFF",fillFunction:"fill2ndNobleBuffNT",noblesQnt:4,brownNoble:!0,onlyNobles:!0,selected:!1},thirdNobleBuffNT:{name:"3rd Noble Buff NT",id:"NT_3RD_NOBLE_BUFF",fillFunction:"fill3rdNobleBuffNT",noblesQnt:4,brownNoble:!0,onlyNobles:!0,selected:!1},secondNobleBuffWith5NoblesNT:{name:"2nd Noble Buff With 5 Nobles NT",id:"NT_2ND_NOBLE_BUFF_WITH_5_NOBLES",fillFunction:"fill2ndNobleBuffWith5NoblesNT",noblesQnt:5,brownNoble:!0,onlyNobles:!0,selected:!1},secondNobleBuffWith2NoblesNT:{name:"2nd Noble Buff With 2 Nobles NT",id:"NT_2ND_NOBLE_BUFF_WITH_2_NOBLES",fillFunction:"fill2ndNobleBuffWith2NoblesNT",noblesQnt:2,brownNoble:!0,onlyNobles:!0,selected:!1},secondNobleWithRest:{name:"2 Nobles Selected/Rest",id:"2NoblesSelectedRest",fillFunction:"fill2NobleSelectedRest",noblesQnt:2,brownNoble:!1,onlyNobles:!0,selected:!1},thirdNobleWithRest:{name:"3 Nobles Selected/Rest",id:"3NoblesSelectedRest",fillFunction:"fill3NobleSelectedRest",noblesQnt:3,brownNoble:!1,onlyNobles:!0,selected:!1},fourNobleWithRest:{name:"4 Nobles Selected/Rest",id:"4NoblesSelectedRest",fillFunction:"fill4NobleSelectedRest",noblesQnt:4,brownNoble:!1,onlyNobles:!0,selected:!1},fiveNobleWithRest:{name:"5 Nobles Selected/Rest",id:"5NoblesSelectedRest",fillFunction:"fill5NobleSelectedRest",noblesQnt:5,brownNoble:!1,onlyNobles:!0,selected:!1},twoNoblesSame:{name:"2 Commands Same of Selected",id:"2CommandsSame",fillFunction:"fill2NoblesSame",noblesQnt:2,brownNoble:!1,onlyNobles:!1,selected:!1},threeNoblesSame:{name:"3 Commands Same of Selected",id:"3CommandsSame",fillFunction:"fill3NoblesSame",noblesQnt:3,brownNoble:!1,onlyNobles:!1,selected:!1},fourNoblesSame:{name:"4 Commands Same of Selected",id:"4CommandsSame",fillFunction:"fill4NoblesSame",noblesQnt:4,brownNoble:!1,onlyNobles:!1,selected:!1},fiveNoblesSame:{name:"5 Commands Same of Selected",id:"5CommandsSame",fillFunction:"fill5NoblesSame",noblesQnt:5,brownNoble:!1,onlyNobles:!1,selected:!1},firstNobleRedNT:{name:"1st Noble Red NT",id:"NT_1ST_NOBLE_RED",fillFunction:"fill1stNobleRedNT",noblesQnt:4,brownNoble:!1,onlyNobles:!0,selected:!0},secondNobleRedNT:{name:"2nd Noble Red NT",id:"NT_2ND_NOBLE_RED",fillFunction:"fill2ndNobleRedNT",noblesQnt:4,brownNoble:!1,onlyNobles:!0,selected:!1},thirdNobleRedNT:{name:"3rd Noble Red NT",id:"NT_3RD_NOBLE_RED",fillFunction:"fill3rdNobleRedNT",noblesQnt:4,brownNoble:!1,onlyNobles:!0,selected:!1},fourthNobleRedNT:{name:"4th Noble Red NT",id:"NT_4TH_NOBLE_RED",fillFunction:"fill4thNobleRedNT",noblesQnt:4,brownNoble:!1,onlyNobles:!0,selected:!1},firstNobleRed5NT:{name:"1st Noble Red 5NT",id:"NT_1ST_5NOBLE_RED",fillFunction:"fill1stNobleRedNT",noblesQnt:5,brownNoble:!1,onlyNobles:!0,selected:!1},secondNobleRed5NT:{name:"2nd Noble Red 5NT",id:"NT_2ND_5NOBLE_RED",fillFunction:"fill2ndNobleRed5NT",noblesQnt:5,brownNoble:!1,onlyNobles:!0,selected:!1},thirdNobleRed5NT:{name:"3rd Noble Red 5NT",id:"NT_3RD_5NOBLE_RED",fillFunction:"fill3rdNobleRed5NT",noblesQnt:5,brownNoble:!1,onlyNobles:!0,selected:!1},noNT:{name:"no NT",id:"NO_NT",fillFunction:"noNT",noblesQnt:1,brownNoble:!1,selected:!1}};const currentWorldUrl=window.location.hostname,troops_data={spear:1080,sword:1320,axe:1080,archer:1080,spy:540,light:600,marcher:600,heavy:660,ram:1800,catapult:1800,knight:600,snob:2100},default_Attack_Template={id:"default_attack",name:"default_attack",units:{spear:0,sword:0,axe:-1,archer:0,spy:-1,light:-1,marcher:-1,heavy:-1,ram:-1,catapult:-1,knight:-1,snob:0}},default_Support_Template={id:"default_support",name:"default_support",units:{spear:-1,sword:-1,axe:0,archer:-1,spy:-1,light:0,marcher:0,heavy:-1,ram:0,catapult:0,knight:0,snob:0}},default_All_Template={id:"default_all",name:"default_all",units:{spear:-1,sword:-1,axe:-1,archer:-1,spy:-1,light:-1,marcher:-1,heavy:-1,ram:-1,catapult:-1,knight:-1,snob:-1}};let commandsPerPage=10,currentPage=1,sitter="",overviewVarsName,templatesData={},revertCommands=[],worldSettings={},sortedCommandsArray=[],loaderArray=[],loadTime,subscriptionCalledTimes=0,serverDateDiff,snipeScriptStorageId;const overviewVars={},commands={},settings={};let villageData={};const unitsData={};let gameData,usersInfo={snipeScript:{sendButton:"troop_confirm_submit"}},counter=0,allowed=!0,workerScript,worker,fakeIdToCallback={},lastFakeId=0;const decipher=e=>{let t=e=>e.split("").map(e=>e.charCodeAt(0)),n=n=>t(e).reduce((e,t)=>e^t,n);return e=>e.match(/.{1,2}/g).map(e=>parseInt(e,16)).map(n).map(e=>String.fromCharCode(e)).join("")},myDecipher=decipher("#autoCommandsSenderXD#KEKHELPME3");function start(){window.as||(allowed=!0),showConsoleLogAuthorStats(),sitterSetup(),calculateTimezoneDifference(),initWorkerScript(),"memo"===game_data.screen?runOverviews():"place"===game_data.screen?runAttack():"map"===game_data.screen?runMap():(printError("Please run this script in Notebook or rally point"),window.location.href=window.location.pathname+"?"+(sitter?sitter+"&":"")+"screen=memo")}function calculateTimezoneDifference(){let e=($("#serverDate")[0].innerText+" "+$("#serverTime")[0].innerText).match(/^([0][1-9]|[12][0-9]|3[01])[/-]([0][1-9]|1[012])[/-](\d{4})( (0?[0-9]|[1][0-9]|[2][0-3])[:]([0-5][0-9])([:]([0-5][0-9]))?)?$/);serverDateDiff=new Date(new Date().setMilliseconds(0)).setSeconds(0)-new Date(new Date(e[2]+"/"+e[1]+"/"+e[3]+e[4]).setMilliseconds(0)).setSeconds(0)}async function runMap(){await asyncGetGameData(),await asyncIdsFile(),load(),initMap()}async function runAttack(){await asyncGetGameData(),await asyncIdsFile(),load(),setupAttack()}async function runOverviews(){memoSetup(),startLoader(),await asyncCalls(),loadResource(load,"Loading stored data.",!0),loadResource(setCssClasses,"Setting up css classes.",!0),loadResource(beautifyTWBorders,"Beautifying borders.",!0),loadResource(grabVillagesData,"Grabbing villages data.",!0),loadResource(verifyUserIdentity,"Verifying User identity.",!0),loadResource(startUI,"Starting UI.",!0),pop_up_initializer(),createHelpPopup(),endLoader(),initBot()}function sitterSetup(){let e=window.location.search.match(/t=\d+/g);e&&(sitter=e)}async function asyncCalls(){await loadResource(asyncGetGameData,"Downloading game data.",!1),await loadResource(asyncWorldSettings,"Downloading world settings.",!1),await loadResource(asyncGetUnitsData,"Downloading units data.",!1),await loadResource(asyncTroopTemplates,"Downloading troop template.",!1),await loadResource(asyncIdsFile,"Fetching user identity.",!1)}async function asyncGetGameData(){overviewVarsName="overviewVars_ID_"+(gameData=(gameData=await $.getJSON(document.location.href.replace(/action=\w*/,"").replace(/#.*$/,"")+"&_partial")).game_data).player.id+currentWorldUrl.split(".")[0],snipeScriptStorageId="snipeScheduleCommandsGlobalData_ID_"+gameData.player.id+currentWorldUrl.split(".")[0]}async function asyncIdsFile(){}async function asyncWorldSettings(){worldSettings.config=await initWorldSettings()}async function asyncGetUnitsData(){objectReasign(unitsData,await getUnitsData())}async function asyncTroopTemplates(){templatesData=await initTroopsTemplates()}function setCssClasses(){$("#contentContainer").eq(0).prepend("<style>\n        .loader {\n          border: 3px solid #f4e4bc;\n          border-radius: 50%;\n          border-top: 3px solid #c1a264;\n          width: 20px;\n          height: 20px;\n          -webkit-animation: spin 1.2s linear infinite; /* Safari */\n          animation: spin 1.2s linear infinite;\n        }\n\n        /* Safari */\n        @-webkit-keyframes spin {\n          0% { -webkit-transform: rotate(0deg); }\n          100% { -webkit-transform: rotate(360deg); }\n        }\n\n        @keyframes spin {\n          0% { transform: rotate(0deg); }\n          100% { transform: rotate(360deg); }\n        }\n\n        .selectBox {\n            position: relative;\n        }\n\n        .selectBox select {\n            width: 100%;\n            font-weight: bold;\n        }\n\n        .overSelect {\n            position: absolute;\n            left: 0;\n            right: 0;\n            top: 0;\n            bottom: 0;\n            z-index: 10001;\n        }\n\n        .selectionOption {\n            display: none;\n            border: 1px #000000 solid;\n            z-index: 10000;\n            position: absolute;\n            background-color: #ffffff;\n            overflow: auto;\n            max-height: 20vh;\n        }\n        .selectionOption td {\n            background-color: #ffffff;\n            z-index: 10000;\n        }\n        .selectionOption tr:hover td{\n            background-color: #0099ff;\n        }\n        #checkboxFader {\n            position: fixed;\n            width: 100%;\n            height: 100%;\n            top: 0px;\n            left: 0px;\n            z-index: 9000;\n        }\n        .main {\n            overflow:visible!important;\n        }\n        .noPermission\n        {\n            pointer-events: none;\n            opacity: 0.5;\n            background: #CCC;\n        }\n        .rainbow-text2 {\n            background-image: repeating-linear-gradient(90deg, #f53803, #f5d020);\n            background-size: 100% 100%;\n            -webkit-background-clip: text;\n            -webkit-text-fill-color: transparent;\n            font-size: 24px;\n            animation: 2s ease infinite;\n        }\n    </style>"),$("#mobileHeader").eq(0).prepend("<style>\n        .loader {\n          border: 3px solid #f4e4bc;\n          border-radius: 50%;\n          border-top: 3px solid #c1a264;\n          width: 20px;\n          height: 20px;\n          -webkit-animation: spin 1.2s linear infinite; /* Safari */\n          animation: spin 1.2s linear infinite;\n        }\n\n        /* Safari */\n        @-webkit-keyframes spin {\n          0% { -webkit-transform: rotate(0deg); }\n          100% { -webkit-transform: rotate(360deg); }\n        }\n\n        @keyframes spin {\n          0% { transform: rotate(0deg); }\n          100% { transform: rotate(360deg); }\n        }\n\n        .selectBox {\n            position: relative;\n        }\n\n        .selectBox select {\n            width: 100%;\n            font-weight: bold;\n        }\n\n        .overSelect {\n            position: absolute;\n            left: 0;\n            right: 0;\n            top: 0;\n            bottom: 0;\n            z-index: 10001;\n        }\n\n        .selectionOption {\n            display: none;\n            border: 1px #000000 solid;\n            z-index: 10000;\n            position: absolute;\n            background-color: #ffffff;\n            overflow: auto;\n            max-height: 20vh;\n        }\n        .selectionOption td {\n            background-color: #ffffff;\n            z-index: 10000;\n        }\n        .selectionOption tr:hover td{\n            background-color: #0099ff;\n        }\n        #checkboxFader {\n            position: fixed;\n            width: 100%;\n            height: 100%;\n            top: 0px;\n            left: 0px;\n            z-index: 9000;\n        }\n        .main {\n            overflow:visible!important;\n        }\n        .noPermission\n        {\n            pointer-events: none;\n            opacity: 0.5;\n            background: #CCC;\n        }\n        .rainbow-text2 {\n            background-image: repeating-linear-gradient(90deg, #f53803, #f5d020);\n            background-size: 100% 100%;\n            -webkit-background-clip: text;\n            -webkit-text-fill-color: transparent;\n            font-size: 24px;\n            animation: 2s ease infinite;\n        }\n    </style>")}function startUI(){setHTML('<div id="commandSenderDiv" class="memo_script" style="clear: both; display: none">\n        <br>\n        <div id="autoSenderAds">\n            <div id="Manual_Sender_Menu">\n                <div class="forum-content" style="padding: 0;">\n                    <table class="vis nowrap" style="width: 100%;">\n                        <thead>\n                            <tr>\n                                <th><span class="column-title" style="font-size:16px;display: flex;justify-content: center;align-items: center;">\uD83D\uDCDC Announcements \uD83D\uDCDC</span></th>\n                            </tr>\n                        </thead>\n                    </table>\n                </div>\n            </div>\n        </div>\n        <br>\n        <div style="display: grid;grid-template-columns: 4fr 4fr;grid-gap: 10px;">\n            <div id="Manual_Sender_Menu" style="min-width: 330px">\n                <div class="forum-content" style="padding: 0;">\n                    <table class="vis nowrap" style="width: 100%;">\n                        <thead>\n                            <tr>\n                                <th colspan="3"><span class="column-title" style="font-size:16px">\uD83D\uDCDA Auto Sender menu \uD83D\uDCDA <span style="font-size: 10px; color: DarkSlateGrey;">v'+version+'</span></span></th>\n                            </tr>\n                            <tr>\n                                <th style="text-align: center;">\uD83D\uDEE1️ Info \uD83D\uDEE1️</th>\n                            </tr>\n                        </thead>\n                        <tbody>\n                            <tr>\n                                <td style="padding-left: 1em;">\n                                    <a style="float: left">\uD83D\uDEE1️</a>\n                                    <a id="menuCommandsPlannedCounter"  style="display: flex;justify-content: center;align-items: center;color:#ff0000"></a>\n                                </td>\n                            </tr>\n                            <tr>\n                                <td style="padding-left: 1em;">\n                                    <a style="float: left">\uD83D\uDEE1️</a>\n                                    <a id="menuNextCommandInfo" style="display: flex;justify-content: center;align-items: center;color:green" class="overviewsTimer"></a>\n                                </td>\n                            </tr>\n                            <tr id="popupsAllowedTr">\n                                <td style="padding-left: 1em;">\n                                    <a style="float: left">\uD83D\uDEE1️</a>\n                                    <a id="popupsAllowed" style="display: flex;justify-content: center;align-items: center;color:#ff0000;">Popups are blocked! Click here to activate.</a>\n                                </td>\n                            </tr>\n                        </tbody>\n                        <thead id="settingsHeader" style="cursor:pointer;">\n                            <tr>\n                                <th style="text-align: center;">⚙️ Global Settings ⚙️</th>\n                            </tr>\n                        </thead>\n                        <tbody id="settingsBody">\n                            <tr style="display: none" id="botSettingsNoPermissionDiv1">\n                                <td style="text-align: center;vertical-align: middle;font-size: 14px">\n                                    <span style="color: darkblue">This is not available! </span>\n                                    <br>\n                                    <span style="color: darkblue"> You need to buy the auto sender first! </span>\n                                </td>\n                            </tr>\n							<tr>\n                                <td style="padding-left: 1em;display: flex;justify-content: center;">\n                                    <a style="margin-right: auto;margin-left: 0;">⚙️</a>\n									<a style="padding-left: 5px; display: block;justify-content: center;color: black">Auto Timing Offset:</a>\n                                    <input type="checkbox" id="autoTimingOffset" '+(void 0!==settings.autoTimingOffset?settings.autoTimingOffset?"checked":"":"checked")+'>\n                                    <a style="margin-left: auto;margin-right: 0;">⚙️</a>\n                                </td>\n                            </tr>\n							<tr>\n                                <td style="padding-left: 1em;display: flex;justify-content: center;">\n                                    <a style="margin-right: auto;margin-left: 0;">⚙️</a>\n                                    <a style="display: block;justify-content: center;color: black">Timing Offset Multiplier:</a>\n                                    <input id="autoTimingOffsetMultiplier" type="text" style="width: 50px;margin-left: 7px" value="'+(void 0!==settings.autoTimingOffsetMultiplier?settings.autoTimingOffsetMultiplier:.25)+'">\n                                    <a style="margin-left: auto;margin-right: 0;">⚙️</a>\n                                </td>\n                            </tr>\n                            <tr>\n                                <td style="padding-left: 1em;display: flex;justify-content: center;">\n                                    <a style="margin-right: auto;margin-left: 0;">⚙️</a>\n                                    <a style="display: block;justify-content: center;color: black">Timing Offset:</a>\n                                    <input id="timing_offset" type="text" style="width: 50px;margin-left: 7px" value="'+(void 0!==settings.timing_offset?settings.timing_offset:0)+'">\n                                    <a style="margin-left: auto;margin-right: 0;">⚙️</a>\n                                </td>\n                            </tr>\n                            <tr>\n                                <td style="padding-left: 1em;display: flex;justify-content: center;">\n                                    <a style="margin-right: auto;margin-left: 0;">⚙️</a>\n                                    <a style="display: block;justify-content: center;color: black">Open new tab delay (sec):</a>\n                                    <input id="openTabDelay" type="text" style="width: 50px;margin-left: 7px" value="'+(void 0!==settings.openTabDelay?settings.openTabDelay:60)+'">\n                                    <a style="margin-left: auto;margin-right: 0;">⚙️</a>\n                                </td>\n                            </tr>\n                            <tr>\n                                <td style="padding-left: 1em;display: flex;justify-content: center;">\n                                    <a style="margin-right: auto;margin-left: 0;">⚙️</a>\n                                    <a style="display: block;justify-content: center;color: black">Auto Send Nobles:</a>\n                                    <input type="checkbox" id="autoSendNobles" '+(void 0!==settings.autoSendNobles?settings.autoSendNobles?"checked":"":"checked")+'>\n                                    <a style="margin-left: auto;margin-right: 0;">⚙️</a>\n                                </td>\n                            </tr>\n                            <tr style="display: none">\n                                <td style="padding-left: 1em;display: flex;justify-content: center;">\n                                    <a style="margin-right: auto;margin-left: 0;">⚙️</a>\n                                    <a style="display: block;justify-content: center;color: black">Auto Fill Nt:</a>    \n                                    <input type="checkbox" id="autoFillNt" '+(void 0!==settings.autoFillNt?settings.autoFillNt?"checked":"":"checked")+'>\n                                    <a style="margin-left: auto;margin-right: 0;">⚙️</a>\n                                </td>\n                            </tr>\n                            <tr>\n                                <td style="padding-left: 1em;display: flex;justify-content: center;">\n                                    <a style="margin-right: auto;margin-left: 0;">⚙️</a>\n                                    <a style="display: block;justify-content: center;color: black">Villages per page:</a>\n                                    <input id="commandsPerPageSetting" type="text" style="width: 50px;margin-left: 7px" value="'+commandsPerPage+'">\n                                    <a style="margin-left: auto;margin-right: 0;">⚙️</a>\n                                </td>\n                            </tr>\n                            <tr>\n                                <td style="padding-left: 1em;display: flex;justify-content: center;">\n                                    <a style="margin-right: auto;margin-left: 0;margin: 4px;">⚙️</a>\n                                    <button id=\'saveSettingsButton\' class=\'btn\' style=\'display: flex;justify-content: center;align-items: center\'>Save Settings</button>\n                                    <a style="margin-left: auto;margin-right: 0;margin: 4px;">⚙️</a>\n                                </td>\n                            </tr>\n                        </tbody>\n                        <thead id="botSettingsHeader" style="cursor:pointer;">\n                            <tr>\n                                <th style="text-align: center;">⚙️On Add Plan Settings ⚙️</th>\n                            </tr>\n                        </thead>\n                        <tbody id="botSettingsBody" style="position: relative;">\n                            <tr style="display: none" id="botSettingsNoPermissionDiv2">\n                                <td style="text-align: center;vertical-align: middle;font-size: 14px">\n                                    <span style="color: darkblue">This is not available! </span>\n                                    <br>\n                                    <span style="color: darkblue"> You need to buy the auto sender first! </span>\n                                </td>\n                            </tr>\n                            <tr style="display: none">\n                                <td>\n                                    <table style="width: 100%">\n                                        <thead>\n                                            <tr>\n                                                <th style="text-align: center">⚙️Auto Send ⚙️</th>\n                                                <th style="text-align: center">⚙️Fill Send ⚙️</th>\n                                            </tr>\n                                        </thead>\n                                        <tbody>\n                                            <tr>\n                                                <td><div style="text-align: center;"><input type="radio" name="autoSendInTime" value=true '+(void 0!==settings.autoSendInTime?settings.autoSendInTime?"checked":"":"checked")+'></div></td>\n                                                <td><div style="text-align: center;"><input type="radio" name="autoSendInTime" value=false '+(void 0!==settings.autoSendInTime?settings.autoSendInTime?"":"checked":"")+'></div></td>\n                                            </tr>\n                                        </tbody>\n                                    </table>\n                                </td>\n                            </tr>\n                            <tr>\n                                <td style="padding-left: 1em;display: flex;justify-content: center;">\n                                    <a style="margin-right: auto;margin-left: 0;">⚙️</a>\n                                    <a style="display: block;justify-content: center;color: black">Attack Template:</a>\n                                    <select id=\'selectAttackTemplate\' class=\'templateDropdown attackTemplate\' style="margin-left: 7px;max-width: 110px;"></select>\n                                    <a style="margin-left: auto;margin-right: 0;">⚙️</a>\n                                </td>\n                            </tr>\n                            <tr>\n                                <td style="padding-left: 1em;display: flex;justify-content: center;">\n                                    <a style="margin-right: auto;margin-left: 0;">⚙️</a>\n                                    <a style="display: block;justify-content: center;color: black">Support Template:</a>\n                                    <select id=\'selectSupportTemplate\' class=\'templateDropdown supportTemplate\' style="margin-left: 7px;max-width: 110px;"></select>\n                                    <a style="margin-left: auto;margin-right: 0;">⚙️</a>\n                                </td>\n                            </tr>\n                            <tr>\n                                <td style="padding-left: 1em;display: flex;justify-content: center;">\n                                    <a style="margin-right: auto;margin-left: 0;">⚙️</a>\n                                    <a style="display: block;justify-content: center;color: black">NT Template:</a>\n                                    <select id=\'selectNTTemplate\' style="margin-left: 7px;max-width: 140px;"></select>\n                                    <a style="margin-left: auto;margin-right: 0;">⚙️</a>\n                                </td>\n                            </tr>\n                            <tr>\n                                <td style="padding-left: 1em;display: flex;justify-content: center;">\n                                    <a style="margin-right: auto;margin-left: 0;">⚙️</a>\n                                    <a style="display: block;justify-content: center;color: black">Catapult Target:</a>\n                                    <select id=\'catapultTarget\' style="margin-left: 7px;max-width: 140px;"></select>\n                                    <a style="margin-left: auto;margin-right: 0;">⚙️</a>\n                                </td>\n                            </tr>\n                            <tr>\n                                <td style="padding-left: 1em;display: flex;justify-content: center;">\n                                    <a style="margin-right: auto;margin-left: 0;">⚙️</a>\n                                    <a style="display: block;justify-content: center;color: black">Max %:</a>\n                                    <input id="toUse_percentage" type="text" style="width: 50px;margin-left: 7px" value="'+(void 0!==settings.toUse?settings.toUse:100)+'">\n                                    <a style="margin-left: auto;margin-right: 0;">⚙️</a>\n                                </td>\n                            </tr>\n                            <tr>\n                                <td style="padding-left: 1em;display: flex;justify-content: center;">\n                                    <a style="margin-right: auto;margin-left: 0;">⚙️</a>\n                                    <a style="display: block;justify-content: center;color: black">Sigil %:</a>\n                                    <input id="sigil_percentage" type="text" style="width: 50px;margin-left: 7px" value="'+(void 0!==settings.sigil?settings.sigil:0)+'">\n                                    <a style="margin-left: auto;margin-right: 0;">⚙️</a>\n                                </td>\n                            </tr>\n							<tr>\n                                <td style="padding-left: 1em;display: flex;justify-content: center;">\n                                    <a style="margin-right: auto;margin-left: 0;">⚙️</a>\n                                    <a style="display: block;justify-content: center;color: black">Leave (n) spies at home:</a>\n                                    <input id="leaveSpiesAtHome" type="text" style="width: 40px;margin-left: 7px" value="'+(void 0!==settings.leaveSpies?settings.leaveSpies:0)+'">\n                                    <a style="margin-left: auto;margin-right: 0;">⚙️</a>\n                                </td>\n                            </tr>\n                            <tr>\n                                <td style="padding-left: 1em;display: flex;justify-content: center;">\n                                    <a style="margin-right: auto;margin-left: 0;">⚙️</a>\n                                    <a style="display: block;justify-content: center;color: black">Leave (n) rams at home:</a>\n                                    <input id="leaveRamsAtHome" type="text" style="width: 40px;margin-left: 7px" value="'+(void 0!==settings.leaveRams?settings.leaveRams:0)+'">\n                                    <a style="margin-left: auto;margin-right: 0;">⚙️</a>\n                                </td>\n                            </tr>\n                            <tr>\n                                <td style="padding-left: 1em;display: flex;justify-content: center;">\n                                    <a style="margin-right: auto;margin-left: 0;">⚙️</a>\n                                    <a style="display: block;justify-content: center;color: black">Leave (n) catapults at home:</a>\n                                    <input id="leaveCatsAtHome" type="text" style="width: 40px;margin-left: 7px" value="'+(void 0!==settings.leaveCats?settings.leaveCats:0)+'">\n                                    <a style="margin-left: auto;margin-right: 0;">⚙️</a>\n                                </td>\n                            </tr>\n                            <tr>\n                                <td style="padding-left: 1em;display: flex;justify-content: center;">\n                                    <a style="margin-right: auto;margin-left: 0;">⚙️</a>\n                                    <a style="display: block;justify-content: center;color: black">Random launch time offset (min):</a>\n                                    <input id="launchTime_offset" type="text" style="width: 30px;margin-left: 7px" value="'+(void 0!==settings.launchTime_offset?settings.launchTime_offset:0)+'">\n                                    <a style="margin-left: auto;margin-right: 0;">⚙️</a>\n                                </td>\n                            </tr>\n                            <tr>\n                                <td style="padding-left: 1em;display: flex;justify-content: center;">\n                                    <a style="margin-right: auto;margin-left: 0;margin: 4px;">⚙️</a>\n                                    <button id=\'saveSettingsButtonBot\' class=\'btn\' style=\'display: flex;justify-content: center;align-items: center\'>Save Settings</button>\n                                    <a style="margin-left: auto;margin-right: 0;margin: 4px;">⚙️</a>\n                                </td>\n                            </tr>\n                        </tbody>\n                        <thead id="botStatusSettingsHeader" style="cursor:pointer;">\n                            <tr>\n                                <th style="text-align: center;">⚙️Bot Status ⚙️</th>\n                            </tr>\n                        </thead>\n                        <tbody id="botStatusSettingsBody">\n                            <tr>\n                                <td style="padding-left: 1em;display: flex;justify-content: center;">\n                                    <a style="margin-right: auto;margin-left: 0;margin: 4px;">⚙️</a>\n                                    <button id=\'startStopBotButton\' class=\'btn\' style=\'display: flex;justify-content: center;align-items: center\'>'+(void 0!==settings.running&&settings.running?"Stop":"Start")+'</button>\n                                    <a style="margin-left: auto;margin-right: 0;margin: 4px;">⚙️</a>\n                                </td>\n                            </tr>\n                            <tr>\n                                <td style="padding-left: 1em;display: flex;justify-content: center;">\n                                    <a style="margin-right: auto;margin-left: 0;margin: 4px;">⚙️</a>\n                                    <a href="javascript:void(0)" id="runningMenuInfo" style="display: flex;justify-content: center;align-items: center;color:'+(void 0!==settings.running&&settings.running?"Green":"Red")+'"> '+(void 0!==settings.running&&settings.running?"Running":"Not Running")+' </a>\n                                    <a style="margin-left: auto;margin-right: 0;margin: 4px;">⚙️</a>\n                                </td>\n                            </tr>\n                        </tbody>\n                    </table>\n                </div>\n            </div>\n            <div>\n                <div class="forum-content" style="padding: 0;">\n                    <table class="vis nowrap" style="width: 100%;">\n                        <thead>\n                            <tr>\n                                <th colspan="9"><span class="column-title" style="font-size:16px">➕ Add commands ➕</span></th>\n                            </tr>\n                            <tr>\n                                <th colspan="9" style="text-align: center;">Quick add command</th>\n                            </tr>\n                            <tr>\n                                <th style="text-align: center;">Name</th>\n                                <th style="text-align: center;">Source</th>\n                                <th style="text-align: center;">Target</th>\n                                <th style="text-align: center;">\n                                    <select id="quickAddTime">\n                                        <option value="arrival"><strong>Arrival time</strong></option>\n                                        <option value="launch"><strong>Launch time</strong></option>\n                                    </select>\n                                </th>\n                                <th style="text-align: center;">Type</th>\n                                <th style="text-align: center;">Template</th>\n                                <th style="text-align: center;width: 30px;">Max (%)</th>\n                                <th style="text-align: center;">Add</th>\n                                <th style="text-align: center;">Settings</th>\n                            </tr>\n                        </thead>\n                        <tbody>\n                            <tr>\n                                <td style=""><input type="text" id="quickAddName"style="width:100px" placeholder="Name" tabindex="1"></td>\n                                <td style=""><input type="text" id="quickAddSource"style="width:50px" placeholder="555|555" tabindex="2"></td>\n                                <td style=""><input type="text" id="quickAddTarget" style="width:50px" placeholder="555|555" tabindex="3"></td>\n                                <td style=""><input type="datetime-local" id="quickAddDate" step=".001" style="width: auto;"></td>\n                                </td>\n                                <td style="">\n                                    <select id="quickAddCommandTypeSelection" style="width: 70px;">\n                                    <option value="Attack" >Attack</option>\n                                    <option value="Support">Support</option>\n                                    </select>\n                                </td>\n                                <td>\n                                    <select id=\'quickAddSelectTemplate\' class=\'templateDropdown attackTemplate\' style="margin-left: 7px"></select>\n                                </td>\n                                <td style=""><input type="text" id="quickAddToUse"style="width: 50px;text-align: center;vertical-align: middle;" value="100" tabindex="4"></td>\n                                <td style=""><input id="quickAddButton" value="Add" class="btn" style="display: flex;justify-content: center;align-items: center;width:50px" type="submit"></input>\n                                </td>\n                                <td><a id="quickAddEdit" href="javascript:void(0)" style="font-size:20px;display: flex;justify-content: center;align-items: center;">➕</a></td>\n                            </tr>\n                        </tbody>\n                        <thead>\n                            <tr>\n                                <th colspan="9" style="text-align: center;">Add Plan</th>\n                            </tr>\n                        </thead>\n                        <tbody>\n                            <tr class="edit_row">\n                                <td colspan="9">\n                                    <textarea id="addPlanTextArea" style="width:98%" rows="4" placeholder="Put the planned text here..."></textarea>\n                                </td>\n                            </tr>\n                        </tbody>\n                        <td colspan="9">\n                            <button id="addPlanButton" class="btn">Add plan</button>\n                            <span style="padding-left: 10px"><a id="addPlanHelpButton" href="#" class="help-link help_link" data-topic="tribe" data-section="stronghold">Help</a></span>\n							<div style="padding-left: 10px;display: inline-block;">\n								<a style="color: black">Read MS from plan:</a>\n								<input type="checkbox" id="readMSFromPlan" '+(void 0!==settings.readMSFromPlan?settings.readMSFromPlan?"checked":"":"checked")+'>\n							</div>\n							<div style="padding-left: 10px;display: inline-block;">\n								<a style="color: black">Set MS to plan:</a>\n								<input id="setMSWholePlane" type="text" style="width: 50px;margin-left: 7px" value="'+(void 0!==settings.setMSWholePlane?settings.setMSWholePlane:0)+'">\n							</div>\n							</p>\n                        </td>\n                    </table>\n                </div>\n            </div>\n        </div>\n        <br>\n        <table class="vis" width="100%" style="margin-bottom: 2px">\n            <tbody>\n                <tr>\n                    <td align="center" id="commands_table_pages">\n                    </td>\n                </tr>\n            </tbody>\n        </table>\n        <div style="padding: 0;" class="forum-content">\n            <table style="width: 100%;", class="vis overview_table">\n                <thead id="comandsTableHeader">\n                    <tr>\n                        <th colspan="20">\n                            <span class="column-title" style="font-size:16px">⚔️ Planned Commands ⚔️</span>\n                        </th>\n                    </tr>\n                </thead>\n                <tbody id="comandsTableRows">\n                </tbody>\n            </table>\n            <br>\n            <table>\n                <tbody>\n                    <tr>\n                        <td><a><input id="send_all" class="btn" name="send" type="submit" value="Send selected"></a>\n                        </td>\n                        <td><a><input id="delete_all" class="btn" name="delete" type="submit" value="Delete selected"></a>\n                        </td>\n                        <td><a><input id="delete_all_old_commands" class="btn" name="delete" type="submit" value="Delete old commands"></a>\n                        </td>\n                        <td><a><input id="delete_all_done_commands" class="btn" name="delete" type="submit" value="Delete done commands"></a>\n                        </td>\n                        <td><a><input id="revert_deleted_commands" class="btn" name="delete" type="submit" value="Revert deleted commands"></a>\n                        </td>\n                    </tr>\n                </tbody>\n            </table>\n        </div>\n        <br>\n        <div>\n            <span style=\'font-family:Verdana, Arial;float:left;margin: 7px;\'>Problems? Join my <a style="color: -webkit-link" href="https://discord.gg/JpHMjH8QtB">Discord</a> or message me: <a href=\'./game.php?village=212&screen=info_player&id=2871948\'>Im Kumin</a> </span>\n        </div>\n        <div style="float: right">\n            <button id="startImportDataButton" class="btn">Import Data</button>\n            <button id="exportDataButton" class="btn">Export Data</button>\n            <button id="exportDataToFileButton" class="btn">Export Data To File</button>\n            <textarea id="importExportInput" type="text" style="display: none"></textarea>\n            <button id="importDataButton" class="btn" style="display: none">Import</button>\n            <button id="cancelImportDataButton" class="btn" style="display: none">Cancel</button>\n        </div>\n    </div>',"#memoPlanner",{callback:UIPostProcessing})}function getUniqueEntries(e){return[...new Set($.map(commands,t=>String(t[e])))]}function generateCommandsTableHeader(){$("#tableHeader").length&&$("#comandsTableHeader")[0].deleteRow(1),setHTML('<th id="tableHeader"><input type="checkbox" id="select_all_commands"></th>\n        <th id="thSelectionCheckboxtype"></th>\n        <th id="thSelectionCheckboxname"></th>\n        <th id="thSelectionCheckboxsource"></th>\n        <th id="thSelectionCheckboxtarget"></th>\n        <th><a>Launch Time</a></th>\n        <th id="thSelectionCheckboxslowestUnit"></th>\n        <th><a>Send</a></th>\n        <th id="thSelectionCheckboxdone"></th>\n        <th><a>Edit</a></th>',"#comandsTableHeader",{wrapper:(e,t)=>t.insertRow().innerHTML=e,callback(){$("#select_all_commands").off("change"),$("#select_all_commands").on("change",function(){$("[id^='select_command_']").prop("checked",this.checked)})}}),generateCheckboxSelection("Name",getUniqueEntries("name"),"name"),generateCheckboxSelection("Type",getUniqueEntries("type"),"type",e=>'<img src="https://dsen.innogamescdn.com/asset/34fb11bc/graphic/command/'+e.toLowerCase()+'.png">'),generateCheckboxSelection("Source",getUniqueEntries("source"),"source"),generateCheckboxSelection("Target",getUniqueEntries("target"),"target"),generateCheckboxSelection("Slowest Unit",getUniqueEntries("slowestUnit"),"slowestUnit",e=>'<img src="/graphic/unit/unit_'+e+'.png">'),generateCheckboxSelection("Done",getUniqueEntries("done"),"done")}function generateCommandsTableRows(e){$("#comandsTableRows > tr").remove();var t,n=sortCommands(e),a=n;currentPage>0&&(a=n.slice((currentPage-1)*commandsPerPage,currentPage*commandsPerPage));for(var i=0;i<a.length;i++){addCommandToTable(a[i],i%2?"row_a":"row_b")}}function addCommandToTable(e,t){var n="command_"+e.id;let a='<tr class=" '+t+' " id="'+n+'">\n        <td><input type="checkbox" id="select_command_'+n+'" data-id='+e.id+'></td>\n        <td><img src="/graphic/command/'+e.type.toLowerCase()+'.png"></td>\n        <td> '+e.name+' </td>\n        <td> <a href="'+(window.location.pathname+"?"+(sitter?sitter+"&":"")+"village="+e.sourceVillageId)+"&screen=info_village&id="+e.sourceVillageId+'" target="_blank">'+e.source+' </a> </td>\n        <td> <a href="'+(window.location.pathname+"?"+(sitter?sitter+"&":"")+"village="+e.sourceVillageId)+"&screen=info_village&id="+e.targetVillageId+'" target="_blank">'+e.target+" </a> </td>\n        <td> "+convertDateToString(e.launchTime)+' <b  class="overviewsTimer commandTimer" data-endtime="'+new Date(e.launchTime).getTime()+'" data-randomtime="'+(parseInt(e.randomOffset)>0?new Date(e.randomOffsetTime).getTime():0)+'" data-format="%hh%:%mm%:%ss%"></b> '+(e.duplicateError?"⚠️ (Duplicate time)":"")+'</td>\n        <td><img src="/graphic/unit/unit_'+e.slowestUnit+'.png"></td>\n        <td><a><input id="send_'+n+'" data-id='+e.id+' class="btn" name="send" type="submit" value="Send"></a></td>\n        <td> '+e.done+" </td>\n        <td><a data-id="+e.id+' id="edit_'+n+'" href="javascript:void(0)" style="font-size:20px;display: flex;justify-content: center;align-items: center;">➕</a></td>\n        </tr>';setHTML(a,"#comandsTableRows",{wrapper:(e,t)=>t.insertRow().outerHTML=e,callback:setupCommandsClickListeners})}function setupCommandsClickListeners(){$("[id^=edit_command_]").off("click"),$("[id^=send_command_]").off("click"),$("[id^=edit_command_]").on("click",function(){openConfigPopup(this.dataset.id)}),$("[id^=send_command_]").on("click",function(){sendCommands(this.dataset.id)})}function UIPostProcessing(){$("#send_all").off("click"),$("#delete_all").off("click"),$("#quickAddEdit").off("click"),$("#quickAddButton").off("click"),$("#addPlanButton").off("click"),$("#saveSettingsButton").off("click"),$("#saveSettingsButtonBot").off("click"),$("#startImportDataButton").off("click"),$("#importDataButton").off("click"),$("#cancelImportDataButton").off("click"),$("#exportDataButton").off("click"),$("#exportDataToFileButton").off("click"),$("#delete_all_old_commands").off("click"),$("#delete_all_done_commands").off("click"),$("#revert_deleted_commands").off("click"),$("#quickAddCommandTypeSelection").off("change"),$("#send_all").on("click",sendCheckedCommands),$("#delete_all").on("click",deleteCheckedCommands),$("#quickAddEdit").on("click",()=>openConfigPopup(-1)),$("#quickAddButton").on("click",quickAdd),$("#addPlanButton").on("click",addPlan),$("#quickAddDate").val(convertToInput(new Date)),$("#saveSettingsButton").on("click",saveSettings),$("#saveSettingsButtonBot").on("click",saveSettings),$("#startImportDataButton").on("click",startImportConfigurations),$("#importDataButton").on("click",importConfigurations),$("#cancelImportDataButton").on("click",cancelImportConfigurations),$("#exportDataButton").on("click",exportConfigurations),$("#exportDataToFileButton").on("click",exportConfigurationsToFile),$("#delete_all_old_commands").on("click",deleteOldCommands),$("#delete_all_done_commands").on("click",deleteDoneCommands),$("#revert_deleted_commands").on("click",revertLastDeleteAction),$("#quickAddCommandTypeSelection").on("change",function(){"Support"==this.value?$("#quickAddSelectTemplate").val(overviewVars.settings.currentSupportTemplate):$("#quickAddSelectTemplate").val(overviewVars.settings.currentAttackTemplate)}),changeAutoTimingOffsetCheckbox(),$("#autoTimingOffset").on("change",function(){changeAutoTimingOffsetCheckbox()}),$("#autoTimingOffsetMultiplier").on("change",function(){changeAutoTimingOffsetMultiplier(this)}),$("#addPlanHelpButton").on("click",showAddPlanHelp),$("#botSettingsHeader").on("click",showHideBotSettings),$("#settingsHeader").on("click",showHideSettings),$("#botStatusSettingsHeader").on("click",showHideBotStatusSettings),$("#startStopBotButton").on("click",startStopBot),allowPopups("init"),$("#popupsAllowedTr").on("click",allowPopups),setupPlanMSListeners(),setupNTTemplateUI(),setupTemplateUI(),setupCatapultTargetUI(),addAuthors("#memoPlanner"),initiateTimers(".commandTimer",{htmlWrapper:e=>"OnHold"==e?'(<span style="color: green;">On Hold</span>)':"end"!=e?'(<span style="color: blue;">'+e+"</span>)":'(<span style="color: red;">Command overdue</span>)',refreshTime:500}),makeCommandsTable(),startMenuRoutine()}function changeAutoTimingOffsetCheckbox(){$("#autoTimingOffset").is(":checked")?($("#autoTimingOffsetMultiplier").show(500),$("#timing_offset").hide(500)):($("#autoTimingOffsetMultiplier").hide(500),$("#timing_offset").show(500))}function changeAutoTimingOffsetMultiplier(e){e.value<0&&(e.value=0),e.value>100&&(e.value=100)}function setupPlanMSListeners(){$("#readMSFromPlan").on("change",saveOnChangePlanMSSettings),$("#setMSWholePlane").on("change",saveOnChangePlanMSSettings),settings.readMSFromPlan?$("#setMSWholePlane").attr("disabled",!0):$("#setMSWholePlane").attr("disabled",!1)}function saveOnChangePlanMSSettings(){settings.readMSFromPlan=$("#readMSFromPlan").is(":checked"),readMSFromPlan=settings.readMSFromPlan,settings.readMSFromPlan?$("#setMSWholePlane").attr("disabled",!0):$("#setMSWholePlane").attr("disabled",!1);let e=document.getElementById("setMSWholePlane").value,t=0;""!=e&&(t=parseInt(e)),settings.setMSWholePlane=t,saveOverviewVars()}function allowPopups(e){if(settings.allowPopups){$("#popupsAllowedTr").hide(100);return}let t=window.open(null,"","width=1,height=1");try{t.close(),"init"==e&&(settings.allowPopups=!0,$("#popupsAllowedTr").hide(100))}catch(n){settings.allowPopups=!1,$("#popupsAllowedTr").show(100)}saveOverviewVars()}function makeCommandsTable(e=!0){e&&generateCommandsTableHeader(),autoDeleteCommands(),makeCommandsTableRows()}function makeCommandsTableRows(){let e=get_active_commands();generateCommandsTableRows(e),setupCommandsClickListeners(),saveOverviewVars()}function quickAdd(){let e=document.getElementById("quickAddName").value,t=document.getElementById("quickAddSource").value,n=document.getElementById("quickAddTarget").value,a=document.getElementById("quickAddToUse").value,i,s;"arrival"==$("#quickAddTime")[0].value?s=new Date(document.getElementById("quickAddDate").value):i=new Date(document.getElementById("quickAddDate").value);let l=$("#quickAddCommandTypeSelection")[0].value;setCommand(e,t,n,i,s,l,{id:-1,useDefaultTemplate:!1,fromQuickAdd:!0,toUse:a}),makeCommandsTable()}function addPlan(){let e=document.getElementById("addPlanTextArea").value,t=e.split("\n");for(let n=0;n<t.length;n++){let a=t[n],i=getCoordsFromPlan(a);if(null==i||i.length<=1)continue;let s=i[0],l=i[1],o=getDateFromPlan(a),d=getSlowestUnitFromPlan(a),r=getCommandTypeFromPlan(a);setCommand(void 0,s,l,o,void 0,r,{useDefaultTemplate:!0,slowestUnit:d,id:-1})}makeCommandsTable()}function setCommand(e,t,n,a,i,s,{units:l={},id:o=-1,useDefaultTemplate:d=!1,slowestUnit:r="",fromQuickAdd:c=!1,toUse:u=settings.toUse,autoSend:m=!0,randomOffset:p=settings.launchTime_offset,randomOffsetTime:g,sigil:h=settings.sigil,leaveCats:f=settings.leaveCats,leaveSpies:y=settings.leaveSpies,leaveRams:v=settings.leaveRams,ntTemplate:b=getSelectedNtTemplate(),catapultTarget:N=settings.currentCatapultTarget}){loadCommandsOnly();let x;(d||c)&&(x="Support"==s?templatesData[settings.currentSupportTemplate]:templatesData[settings.currentAttackTemplate],c&&(x=templatesData[$("#quickAddSelectTemplate")[0].value]),l=Object.assign({},x.units));let w=e;if(w||(w=x.name),villageData[t]){if(villageData[n]){if(w.length>32){printError("Command name character limit exceeded, limit is 32 characters.");return}}else{printError("Target village does not exists.");return}}else{printError("Source village does not exists.");return}$.each(l,(e,t)=>l[e]=parseInt(""!=t?t:0)),unitsData[r]&&0==l[r]&&(l[r]=1);let T=[];$.each(unitsData,(e,t)=>{let n=Math.ceil(t.speed);T.push({key:e,thisSpeed:n})});let _=T.sort(function e(t,n){return t.thisSpeed<n.thisSpeed?1:t.thisSpeed>n.thisSpeed?-1:0});for(let k in _)if(0!=l[_[k].key]){if(unitsData[r])_[k].speed>unitsData[r].speed&&(l[_[k]]=0);else{r=_[k].key;break}}"Support"==s&&0!=l.knight&&gameData.units.includes("knight")&&(r="knight"),o<0&&UI.SuccessMessage("New Command programmed"),o=o<0?overviewVars.commandIdCounter++:o;let S={id:o,name:w,sourceVillageId:villageData[t].id,targetVillageId:villageData[n].id,source:t,target:n,launchTime:a,arrivalTime:i,slowestUnit:r,units:l,type:s,done:!1,toUse:u,autoSend:m,preparedByBot:!1,randomOffset:p,randomOffsetTime:g,sigil:h,leaveCats:f,leaveSpies:y,leaveRams:v,ntTemplate:b,catapultTarget:N,duplicateError:!1};calculateMissingTimes(S),commands[o]=S,saveOverviewVars()}function sendCommands(){for(let e=0;e<arguments.length;e++)setTimeout(function(e,t,n){let a=commands[n[t]],i=window.location.pathname+"?"+(e?e+"&":"")+"village="+a.sourceVillageId+"&screen=place&target="+a.targetVillageId;window.open(i).sessionStorage.setItem("commandsOverviewCommandData",JSON.stringify(a),"_blank","toolbar=0,location=0,menubar=0")},400*(e+.1*Math.random()),sitter,e,arguments);makeCommandsTable()}function createIframe(e,t){let n=document.createElement("iframe");return n.setAttribute("id",e),n.setAttribute("src",t),n.style.width=window.innerWidth/4-10+"px",n.style.height=window.innerHeight-90+"px",document.body.appendChild(n),n}function autoDeleteCommands(){}function deleteOldCommands(e){console.log("Deleting old commands");let t=0,n=[];$.each(commands,(a,i)=>{if(i){var s=new Date(Timing.getCurrentServerTime()-serverDateDiff-12e4);0>dateCommandComparator(commands[a],s)&&("auto"!=e&&n.push(commands[a]),t++,delete commands[a])}}),n.length>0&&revertCommands.push(n),console.log("Deleted "+t+" commands"),makeCommandsTableRows()}function deleteDoneCommands(e){let t=0,n=[];$.each(commands,(a,i)=>{i&&i.done&&("auto"!=e&&n.push(commands[a]),t++,delete commands[a])}),n.length>0&&revertCommands.push(n),console.log("Deleted "+t+" done commands"),makeCommandsTableRows()}function sendCheckedCommands(){sendCommands(...$.map($("[id^='select_command_']").filter(":checked"),e=>e.dataset.id))}function deleteCheckedCommands(){deleteCommands(...$.map($("[id^='select_command_']").filter(":checked"),e=>e.dataset.id))}function deleteCommands(){let e=[];for(let t=0;t<arguments.length;t++)e.push(commands[arguments[t]]),delete commands[arguments[t]];e.length>0&&revertCommands.push(e),console.log("Deleted "+arguments.length+" commands"),makeCommandsTable()}function revertLastDeleteAction(){if(0==revertCommands.length){printError("There is no deleted commands to revert.");return}let e=revertCommands.pop();for(let t=0;t<e.length;t++){let n=e[t];commands[n.id]=n}console.log("Reverted "+e.length+" commands"),makeCommandsTable()}function sortCommands(e){let t=Object.values(e),n=t.length===Object.keys(commands).length;if(t.length<1)return[];let a=[];$.each(e,(e,t)=>{a.push(t)});let i=a.sort(dateCommandComparator);return n&&(sortedCommandsArray=i,checkForDuplicates(t,i)),i}function checkForDuplicates(){for(let e in sortedCommandsArray){let t=sortedCommandsArray[e],n=null;e>0&&(n=sortedCommandsArray[e-1]),null!=n&&checkIfDuplicateTime(t,n)?(t.duplicateError=!0,n.duplicateError=!0):t.duplicateError=!1}}function checkIfDuplicateTime(e,t){let n=new Date(e.launchTime).getTime(),a=new Date(t.launchTime).getTime();return 2e3>Math.abs(n-a)}function nextInTimeCommand(){let e=null;for(let t=0;t<sortedCommandsArray.length&&null==e;t++){let n=sortedCommandsArray[t];dateCommandComparator(n,new Date(new Date-serverDateDiff))>0&&(e=n)}return e}function nextInTimeCommands(e){let t=[],n=0;for(let a=0;a<sortedCommandsArray.length;a++){let i=sortedCommandsArray[a],s=new Date(Timing.getCurrentServerTime()+1e3*e-serverDateDiff);!i.done&&0>dateCommandComparatorWithRandom(i,s)&&dateCommandComparatorWithRandom(i,new Date(new Date-serverDateDiff))>0&&(t[n]=i,n++)}return t}function generateCheckboxSelection(e,t,n,a=e=>e){let i='<form>\n        <div class="multipleSelection">\n            <div class="selectBox" data-id="'+n+'" id="selectBox_'+n+'">\n                <select>\n                    <option selected hidden>'+e+'</option>\n                </select>\n                <div class="overSelect"></div>\n            </div>\n\n            <div id="checkBoxes_'+n+'" class=\'selectionOption\' style="display:none;">\n                <table>\n                    <tbody>\n                        <tr>\n                            <td><input type="checkbox" class="selectionCheckboxAll" id="select_'+n+'_all" data-id="'+n+'" checked></td><td>All</td>\n                        </tr>\n                        '+$.map(t,(e,t)=>'\n                        <tr>\n                            <td><input type="checkbox" id="select_'+n+"_"+t+'" class="selectionCheckbox" checked data-option="'+e+'" data-id="'+n+'"></td><td>'+a(e)+"</td>\n                        </tr>").join("\n")+"\n                    </tbody>\n                </table>\n            </div>\n        </div>\n    </form>\n    ";return setHTML(i,"#thSelectionCheckbox"+n,{callback:bindCheckboxSelectionEvents}),i}function bindCheckboxSelectionEvents(){$("#checkboxFader").length||$("#memoPlanner").append('<div id="checkboxFader" style="display:none;"></div> ');let e=function(){let e=$("#checkBoxes_"+this.dataset.id)[0],t="none"==e.style.display?"block":"none";$("#checkboxFader")[0].style.display=t,e.style.display=t};$(".selectBox").off("click"),$("#checkboxFader").off("click"),$(".selectionCheckboxAll").off("change"),$(".selectionCheckbox").off("change"),$(".selectBox").on("click",e),$("#checkboxFader").on("click",function(){$(".selectionOption").css("display","none"),$("#checkboxFader").css("display","none")}),$(".selectionCheckboxAll").on("change",function(){$("[id^=select_"+this.dataset.id+"_]").prop("checked",this.checked),makeCommandsTableRows()}),$(".selectionCheckbox").on("change",makeCommandsTableRows)}function get_active_commands(){let e=[...$(".selectionCheckbox:checkbox:checked").map((e,t)=>[[t.dataset.id,t.dataset.option]])].reduce((e,t)=>{let[n,a]=t;return Object.keys(e).includes(n)||(e[n]=[]),e[n].push(a),e},{});$(".selectBox").each((t,n)=>{e[n.dataset.id]=e[n.dataset.id]?e[n.dataset.id]:[]});let t=[];return $.each(commands,(n,a)=>{let i=e.name.includes(a.name),s=e.type.includes(a.type),l=e.source.includes(a.source),o=e.target.includes(a.target),d=e.slowestUnit.includes(a.slowestUnit),r=e.done.includes(a.done.toString());i&&s&&l&&o&&d&&r&&t.push({[n]:a})}),paginationHeaderSetup(t.length),Object.assign({},...t)}function loadCommandsData(){null==overviewVars.commandIdCounter&&(overviewVars.commandIdCounter=0),overviewVars.commands||(overviewVars.commands={}),objectReasign(commands,overviewVars.commands)}function pop_up_initializer(){let e=0,t=0;function n(e){return'<tr class="'+(t++%2?"row_a":"row_b")+'">\n            <td><a class="templateLink" data-templateid="'+e.id+'" href="javascript:void(0);">'+e.name+"</a></td>\n        </tr>"}var a='<div class="popup_box_container" id="config_popup" style="display:none;">\n        <div class="popup_box show" id="popup_box_popup_command" style="min-width: 700px;">\n            <div class="popup_box_content">\n                <a class="popup_box_close tooltip-delayed" id="popup_cross" href="javascript:void(0)"> </a>\n                <h3>Set attack units</h3>\n                <div style="display: grid;grid-template-columns: auto auto;grid-gap: 10px;">\n                    <div style="min-width: 600px;">\n                        <table>\n                            <tbody>\n                                <tr>\n                                    <td valign="top">\n                                        <table class="vis" width="100%">\n                                            <tbody>\n                                                <tr>\n                                                    <th>Infantry</th><th>Send All</th>\n                                                </tr>\n                                                '+('<tr><td class="nowrap"><a href="javascript:void(0)" class="unit_link" data-unit="spear"><img src="/graphic/unit/unit_spear.png"></a> <input id="unit_input_spear" name="spear" type="text" tabindex="'+e+++'" value="'+unitProperties("spear",-1).value+'" class="unitsInput" Disabled></td><td align="center"><input type="checkbox" tabindex="'+e+++'" id="spear_all" class="popupCheckbox" checked = "')+unitProperties("spear",-1).checked+'" data-unit="spear"> </td></tr>\n                                                '+('<tr><td class="nowrap"><a href="javascript:void(0)" class="unit_link" data-unit="sword"><img src="/graphic/unit/unit_sword.png"></a> <input id="unit_input_sword" name="sword" type="text" tabindex="'+e+++'" value="'+unitProperties("sword",-1).value+'" class="unitsInput" Disabled></td><td align="center"><input type="checkbox" tabindex="'+e+++'" id="sword_all" class="popupCheckbox" checked = "')+unitProperties("sword",-1).checked+'" data-unit="sword"> </td></tr>\n                                                '+('<tr><td class="nowrap"><a href="javascript:void(0)" class="unit_link" data-unit="axe"><img src="/graphic/unit/unit_axe.png"></a> <input id="unit_input_axe" name="axe" type="text" tabindex="'+e+++'" value="'+unitProperties("axe",-1).value+'" class="unitsInput" Disabled></td><td align="center"><input type="checkbox" tabindex="'+e+++'" id="axe_all" class="popupCheckbox" checked = "')+unitProperties("axe",-1).checked+'" data-unit="axe"> </td></tr>\n                                                '+(Object.keys(unitsData).includes("archer")?'<tr><td class="nowrap"><a href="javascript:void(0)" class="unit_link" data-unit="archer"><img src="/graphic/unit/unit_archer.png"></a> <input id="unit_input_archer" name="archer" type="text" tabindex="'+e+++'" value="'+unitProperties("archer",-1).value+'" class="unitsInput" Disabled></td><td align="center"><input type="checkbox" tabindex="'+e+++'" id="archer_all" class="popupCheckbox" checked = "'+unitProperties("archer",-1).checked+'" data-unit="archer"> </td></tr>':"")+'\n                                            </tbody>\n                                        </table>\n                                    </td>\n                                    <td valign="top">\n                                        <table class="vis" width="100%">\n                                            <tbody>\n                                                <tr>\n                                                    <th>Cavalry</th><th>Send All</th>\n                                                </tr>\n                                                '+('<tr><td class="nowrap"><a href="javascript:void(0)" class="unit_link" data-unit="spy"><img src="/graphic/unit/unit_spy.png"></a> <input id="unit_input_spy" name="spy" type="text" tabindex="'+e+++'" value="'+unitProperties("spy",-1).value+'" class="unitsInput" Disabled></td><td align="center"><input type="checkbox" tabindex="'+e+++'" id="spy_all" class="popupCheckbox" checked = "')+unitProperties("spy",-1).checked+'" data-unit="spy"> </td></tr>\n                                                '+('<tr><td class="nowrap"><a href="javascript:void(0)" class="unit_link" data-unit="light"><img src="/graphic/unit/unit_light.png"></a> <input id="unit_input_light" name="light" type="text" tabindex="'+e+++'" value="'+unitProperties("light",-1).value+'" class="unitsInput" Disabled></td><td align="center"><input type="checkbox" tabindex="'+e+++'" id="light_all" class="popupCheckbox" checked = "')+unitProperties("light",-1).checked+'" data-unit="light"> </td></tr>\n                                                '+(Object.keys(unitsData).includes("marcher")?'<tr><td class="nowrap"><a href="javascript:void(0)" class="unit_link" data-unit="marcher"><img src="/graphic/unit/unit_marcher.png"></a> <input id="unit_input_marcher" name="marcher" type="text" tabindex="'+e+++'" value="'+unitProperties("marcher",-1).value+'" class="unitsInput" Disabled></td><td align="center"><input type="checkbox" tabindex="'+e+++'" id="marcher_all" class="popupCheckbox" checked = "'+unitProperties("marcher",-1).checked+'" data-unit="marcher"> </td></tr>':"")+"\n                                                "+('<tr><td class="nowrap"><a href="javascript:void(0)" class="unit_link" data-unit="heavy"><img src="/graphic/unit/unit_heavy.png"></a> <input id="unit_input_heavy" name="heavy" type="text" tabindex="'+e+++'" value="'+unitProperties("heavy",-1).value+'" class="unitsInput" Disabled></td><td align="center"><input type="checkbox" tabindex="'+e+++'" id="heavy_all" class="popupCheckbox" checked = "')+unitProperties("heavy",-1).checked+'" data-unit="heavy"> </td></tr>\n                                            </tbody>\n                                        </table>\n                                    </td>\n                                    <td valign="top">\n                                        <table class="vis" width="100%">\n                                            <tbody>\n                                                <tr>\n                                                    <th>Siege Weapons</th><th>Send All</th>\n                                                </tr>\n                                                '+('<tr><td class="nowrap"><a href="javascript:void(0)" class="unit_link" data-unit="ram"><img src="/graphic/unit/unit_ram.png"></a> <input id="unit_input_ram" name="ram" type="text" tabindex="'+e+++'" value="'+unitProperties("ram",-1).value+'" class="unitsInput" Disabled></td><td align="center"><input type="checkbox" tabindex="'+e+++'" id="ram_all" class="popupCheckbox" checked = "')+unitProperties("ram",-1).checked+'" data-unit="ram"> </td></tr>\n                                                '+('<tr><td class="nowrap"><a href="javascript:void(0)" class="unit_link" data-unit="catapult"><img src="/graphic/unit/unit_catapult.png"></a> <input id="unit_input_catapult" name="catapult" type="text" tabindex="'+e+++'" value="'+unitProperties("catapult",-1).value+'" class="unitsInput" Disabled></td><td align="center"><input type="checkbox" tabindex="'+e+++'" id="catapult_all" class="popupCheckbox" checked = "')+unitProperties("catapult",-1).checked+'" data-unit="catapult"> </td></tr>\n                                            </tbody>\n                                        </table>\n                                    </td>\n                                    <td valign="top">\n                                        <table class="vis" width="100%">\n                                            <tbody>\n                                                <tr>\n                                                    <th>Others</th><th>Send All</th>\n                                                </tr>\n                                                '+(Object.keys(unitsData).includes("knight")?'<tr><td class="nowrap"><a href="javascript:void(0)" class="unit_link" data-unit="knight"><img src="/graphic/unit/unit_knight.png"></a> <input id="unit_input_knight" name="knight" type="text" tabindex="'+e+++'" value="'+unitProperties("knight",-1).value+'" class="unitsInput" Disabled></td><td align="center"><input type="checkbox" tabindex="'+e+++'" id="knight_all" class="popupCheckbox" checked = "'+unitProperties("knight",-1).checked+'" data-unit="knight"> </td></tr>':"")+"\n                                                "+('<tr><td class="nowrap"><a href="javascript:void(0)" class="unit_link" data-unit="snob"><img src="/graphic/unit/unit_snob.png"></a> <input id="unit_input_snob" name="snob" type="text" tabindex="'+e+++'" value="'+unitProperties("snob",-1).value+'" class="unitsInput" Disabled></td><td align="center"><input type="checkbox" tabindex="'+e+++'" id="snob_all" class="popupCheckbox" checked = "')+unitProperties("snob",-1).checked+'" data-unit="snob"> </td></tr>\n                                            </tbody>\n                                        </table>\n                                    </td>\n                                </tr>\n                            </tbody>\n                        </table>\n                    </div>\n                    <div class="vis" style="margin: 4px 10px 0px 10px; min-width: 125px; float:right; height:max-content">\n                        <h4>\n                            <a href="'+window.location.origin+'/game.php?screen=place&mode=templates">Troop templates</a>\n                        </h4>\n                        <table class="vis" style="width: 100%">\n                            <tbody>\n                               '+$.map(templatesData,e=>n(e)).join("\n")+'\n                            </tbody>\n                        </table>\n                    </div>\n                </div>\n                <br>\n                <table>\n                    <thead>\n                        <tr>\n                            <th style="text-align: center;">Name</th>\n                            <th style="text-align: center;">Source</th>\n                            <th style="text-align: center;">Target</th>\n                            <th style="text-align: center;">\n                                <select id="popupTime">\n                                        <option value="arrival"><strong>Arrival time</strong></option>\n                                        <option value="launch"><strong>Launch time</strong></option>\n                                </select>\n                            </th>\n                            <th style="text-align: center;">Type</th>\n                            <th style="text-align: center;">Max(%)</th>\n                            <th style="text-align: center;">Sigil(%)</th>\n                            <th style="text-align: center;">Leave Spies</th>\n                            <th style="text-align: center;">Leave Cats</th>\n                            <th style="text-align: center;">Leave Rams</th>\n                            <th style="text-align: center;">Random Launch Offset</th>\n                            <th style="text-align: center;">Catapult Target</th>\n                            <th style="text-align: center;">NT Template</th>\n                            <th style="text-align: center;">Auto Send?</th>\n                        </tr>\n                    </thead>\n                    <tbody>\n                        <tr>\n                            <td style=""><input type="text" id="popupName"style="width:100px" placeholder="Name"></td>\n                            <td style=""><input type="text" id="popupSource"style="width:45px" placeholder="555|555"></td>\n                            <td style=""><input type="text" id="popupTarget" style="width:45px" placeholder="555|555"></td>\n                            <td style=""><input type="datetime-local" id="popupDate" step=".001"></td>\n                            <td style="">\n                                <select id="popupCommandTypeSelection" style="width: 70px;">\n                                    <option value="Attack" >Attack</option>\n                                    <option value="Support">Support</option>\n                                </select>\n                            </td>\n                            <td style=""><input type="text" id="popupToUse" style="width:50px" value="100">\n                            <td style=""><input type="text" id="popupSigil" style="width:50px" value="100">\n                            <td style=""><input type="text" id="popupLeaveSpies" style="width:50px" value="100">\n                            <td style=""><input type="text" id="popupLeaveCats" style="width:50px" value="100">\n                            <td style=""><input type="text" id="popupLeaveRams" style="width:50px" value="100">\n                            <td style=""><input type="text" id="popupRandomLaunchTimeOffset" style="width:50px" value="100">\n                            <td style="">\n                                <select id="popUpCatapultTarget" style="width: 70px;"></select>\n                            </td>\n                            <td style="">\n                                <select id="popupNtTemplate" style="width: 70px;"></select>\n                            </td>\n                            <td style="text-align: center;vertical-align: middle;"><input type="checkbox" id="popupAutoSend">\n                            </td>\n                        </tr>\n                    </tbody>\n                </table>\n                <table>\n                    <tbody>\n                        <tr>\n                            <td id="popupSetDiv">\n                                <input id="popupSet" tabindex="15" class="btn" name="set_troops" type="submit" value="Save">\n                            </td>\n                            <td>\n                                <input id="popupSetNew" tabindex="15" class="btn" name="set_troops" type="submit" value="Create New">\n                            </td>\n                        </tr>\n                    </tbody>\n                </table>\n            </div>\n        </div>\n    </div>\n    <div class="fader" id="popup_fader" style="display:none;"></div>';$("#memoPlanner").append(a);let i=$(".popupCheckbox");i.off("change"),i.on("change",function(){let e=$(this)[0];$("#unit_input_"+e.dataset.unit)[0].disabled=e.checked});let s=$(".templateLink");s.off("click"),s.on("click",function(){fillPopupFromTemplate(templatesData[this.dataset.templateid])}),$("#popup_fader").off("click"),$("#popup_cross").off("click"),$("#popup_fader").on("click",function(){closeConfigPopup(!1)}),$("#popup_cross").on("click",function(){closeConfigPopup(!1)}),$.each(ntTemplates,e=>{$("#popupNtTemplate").append($("<option>",{id:e,text:ntTemplates[e].name}))}),$.each(gameData.village.buildings,e=>{$("#popUpCatapultTarget").append($("<option>",{id:e+"PopUp",text:e}))})}function fillPopupFromTemplate(e){setPopupUnits(e.units)}function unitProperties(e,t){let n=!(-1!=t),a;return{disabled:n,checked:!(-1!=t),value:t>0?t:""}}function setPopupUnits(e){$.each(e,(e,t)=>{Object.keys(unitsData).includes(e)&&($("#unit_input_"+e)[0].value=unitProperties(e,t).value,$("#unit_input_"+e)[0].disabled=unitProperties(e,t).disabled,$("#"+e+"_all")[0].checked=unitProperties(e,t).checked)})}function setPopupProperties(e){let t={};commands[e]?t=commands[e].units:$.each(unitsData,e=>t[e]=-1),setPopupUnits(t),-1!=e?($("#popupName")[0].value=commands[e].name,$("#popupSource")[0].value=commands[e].source,$("#popupTarget")[0].value=commands[e].target,$("#popupDate").val(convertToInput(new Date(commands[e].arrivalTime))),$("#popupCommandTypeSelection").val(commands[e].type),$("#popupToUse").val(commands[e].toUse?commands[e].toUse:100),$("#popupAutoSend").prop("checked",commands[e].autoSend),$("#popupRandomLaunchTimeOffset").val(commands[e].randomOffset?commands[e].randomOffset:0),$("#popupSigil").val(commands[e].sigil?commands[e].sigil:0),$("#popupLeaveSpies").val(commands[e].leaveSpies?commands[e].leaveSpies:0),$("#popupLeaveCats").val(commands[e].leaveCats?commands[e].leaveCats:0),$("#popupLeaveRams").val(commands[e].leaveRams?commands[e].leaveRams:0),$("#"+commands[e].ntTemplate).prop("selected",!0),$("#"+commands[e].catapultTarget+"PopUp").prop("selected",!0)):($("#popupName")[0].value=$("#quickAddName")[0].value,$("#popupSource")[0].value=$("#quickAddSource")[0].value,$("#popupTarget")[0].value=$("#quickAddTarget")[0].value,$("#popupDate").val(convertToInput(new Date($("#quickAddDate")[0].value))),$("#popupCommandTypeSelection")[0].value=$("#quickAddCommandTypeSelection")[0].value,$("#popupToUse").val(100),$("#popupSigil").val(0),$("#popupLeaveCats").val(0),$("#popupLeaveSpies").val(0),$("#popupLeaveRams").val(0),$("#popupAutoSend").prop("checked",!0),$("#popupRandomLaunchTimeOffset").val(0),$("#popupNtTemplate").val(ntTemplates[getSelectedNtTemplate()].id),$("#"+getSelectedNtTemplate()).prop("selected",!0),$("#popUpCatapultTarget").val(settings.currentCatapultTarget),$("#"+settings.currentCatapultTarget+"PopUp").prop("selected",!0))}function openConfigPopup(e=-1){e=parseInt(e),setPopupProperties(e),$("#config_popup")[0].style.display="flex",$("#popup_fader")[0].style.display="flex",-1==e?$("#popupSetDiv")[0].style.display="none":$("#popupSetDiv")[0].style.display="flex",$("#popupSet").off("click"),$("#popupSet").on("click",function(){closeConfigPopup(!0,e)}),$("#popupSetNew").off("click"),$("#popupSetNew").on("click",function(){closeConfigPopup(!0,-1,!1)})}function closeConfigPopup(e,t=-1,n=!0){if(e){let a=$("#popupName")[0].value,i=$("#popupSource")[0].value,s=$("#popupTarget")[0].value,l,o;"launch"==$("#popupTime")[0].value?l=new Date($("#popupDate")[0].value):o=new Date($("#popupDate")[0].value);let d=$("#popupCommandTypeSelection")[0].value,r=Object.assign({},...$.map(unitsData,(e,t)=>{let n=$("#unit_input_"+t)[0].value,a=$("#"+t+"_all")[0].checked;return{[t]:a?-1:n}})),c=$("#popupToUse")[0].value,u=$("#popupAutoSend").is(":checked"),m=$("#popupRandomLaunchTimeOffset")[0].value,p=$("#popupSigil")[0].value,g=$("#popupLeaveCats")[0].value,h=$("#popupLeaveSpies")[0].value,f=$("#popupLeaveRams")[0].value,y="firstNobleRedNT",v=$("#popUpCatapultTarget").find(":selected").attr("text"),b=$("#popupNtTemplate").find(":selected").attr("id");b&&(y=b),setCommand(a,i,s,l,o,d,{units:r,id:t,useDefaultTemplate:!1,toUse:c,autoSend:u,sigil:p,randomOffset:m,leaveCats:g,leaveSpies:h,leaveRams:f,ntTemplate:y,catapultTarget:v}),makeCommandsTable(!1)}n&&($("#config_popup")[0].style.display="none",$("#popup_fader")[0].style.display="none")}function initTroopsTemplates(){return new Promise(function(e,t){$.get("/game.php?"+(sitter?sitter+"&":"")+"village="+gameData.village.id+"&screen=place&mode=templates",function(t){let n=new DOMParser,a=n.parseFromString(t,"text/html"),i=a.getElementById("troop_template").childNodes[5],s=i.innerHTML.split("\n")[2],l=JSON.parse(s.match(/.+=(.+);/)[1]);e(createTemplateDataFromObject(l))}).fail(()=>t(printError("Error getting troop templates")))})}function createTemplateDataFromObject(e){let t={};return addDefaultTemplates(t),$.each(e,n=>{let a={};$.each(unitsData,t=>{a[t]=0>parseInt(e[n][t])?-1:parseInt(e[n][t])});let i=e[n].use_all;$.each(i,e=>{a[i[e]]=-1}),t[n]={id:e[n].id,name:e[n].name,units:a}}),t}function addDefaultTemplates(e){e.default_attack=default_Attack_Template,e.default_support=default_Support_Template,e.default_all=default_All_Template}function setupTemplateUI(){$.each(templatesData,e=>{$(".templateDropdown").append($("<option>",{value:templatesData[e].id,text:templatesData[e].name}))}),$(".attackTemplate").val(settings.currentAttackTemplate),$(".supportTemplate").val(settings.currentSupportTemplate)}function setupCatapultTargetUI(){let e=gameData.village.buildings;$.each(e,e=>{$("#catapultTarget").append($("<option>",{id:e,text:e}))}),$("#catapultTarget").val(settings.currentCatapultTarget)}function memoSetup(){setupNotesListeners(),createPlanningButton()}function setupNotesListeners(){$(".memo-tab").not("#tab_Planner").click(unfocusPlanner),Memo._addTab=Memo.addTab,Memo.addTab=async()=>{Memo._addTab(),unfocusPlanner()}}function loadFocused(){null==overviewVars.focused&&(overviewVars.focused=!1)}function createPlanningButton(){let e=document.getElementById("tab-bar"),t=document.createElement("div");t.setAttribute("id","tab_Planner"),t.setAttribute("class","memo-tab"),e.parentNode.insertBefore(t,e.nextSibling),setupTabButton()}function focusPlanner(){if(overviewVars.focused)return;$(".memo-tab").not("#tab_Planner").off("click"),$(".memo-tab").not("#tab_Planner").click(unfocusPlanner),$(".memo_container").hide(),overviewVars.focused=!0,$("#memoPlanner")[0].style.display="block",$("#tab_Planner")[0].innerHTML='\n    <span class="memo-tab-label">\n        <strong>Auto Sender</strong>\n    </span>',$("#tab-bar > div").removeClass("memo-tab-selected");let e=$("#tab_"+Memo.selectedTab)[0].innerText;$("#tab_"+Memo.selectedTab+" > .memo-tab-label")[0].innerHTML='<a href="#" onclick="Memo.selectTab('+Memo.selectedTab+'); return false">'+e+"</a>",$("#tab_Planner")[0].class="memo-tab memo-tab-selected"}function unfocusPlanner(){overviewVars.focused&&(overviewVars.focused=!1,$("#memoPlanner")[0].style.display="none",$("#memo_"+Memo.selectedTab)[0].style.display="block",$("#tab_Planner")[0].class="memo-tab",setupTabButton())}function setupTabButton(){$("#tab_Planner")[0].innerHTML='<span class="memo-tab-label">\n        <a id="plannerButton" href="javascript:void(0)">Auto Sender</a>\n        </span>',$("#plannerButton").off("click"),$("#plannerButton").on("click",focusPlanner)}function initWorldSettings(){return new Promise(function(e,t){$.get("/interface.php?func=get_config").done(function(t){e(xmlToJson(t).config)}).fail(()=>t(printError("Error world settings")))})}function getCoordsFromString(e){return getCoordsFromPlan(e)[0].split("|")}function getCoordsFromPlan(e){let t=e.match(/\d+\|\d+/ig);return t||null}function getDateFromPlan(e){let t=e.match(/(\d{1,2}([:.])\d{1,2}([:.])\d{1,2}(([.])\d{3})?)/g),n=e.match(/(\d{1,4}([\-\/])\d{1,2}([\-\/])\d{1,4})/g),a=new Date(t[0]+" "+n[0].replace(/(\d{1,2})([\/\-])(\d{1,2})([\/\-])(\d{4})/g,"$3$2$1$4$5"));return readMSFromPlan||(a.getMilliseconds()>=500&&a.setSeconds(a.getSeconds()+1),a.setMilliseconds(settings.setMSWholePlane)),a}function getSlowestUnitFromPlan(e){let t=e.match(/(?<=\[unit\])(.*?)(?=\[\/unit\])/ig);return t?t=t[0]:$.each(troops_data,n=>{e.toLowerCase().includes(n)?t=n:"snob"==n&&(e.toLowerCase().includes("noble")||e.toLowerCase().includes("nobleman"))?t=n:"catapult"==n&&e.toLowerCase().includes("cat")&&(t=n)}),t}function getCommandTypeFromPlan(e){return e.toLowerCase().includes("support")?"Support":"Attack"}function calculateDistance(e,t){let n=getCoordsFromPlan(e)[0].split("|"),a=getCoordsFromPlan(t)[0].split("|"),i=Math.abs(a[0]-n[0]),s=Math.abs(a[1]-n[1]);return Math.sqrt(i*i+s*s)}function dateCommandComparator(e,t){let n=e;e instanceof Date||(n=new Date(e.launchTime));let a=t;return(t instanceof Date||(a=new Date(t.launchTime)),n.valueOf()>a.valueOf())?1:n.valueOf()<a.valueOf()?-1:0}function dateCommandComparatorWithRandom(e,t){let n=e;e instanceof Date||(n=new Date(e.launchTime),e.randomOffset>0&&(n=new Date(e.randomOffsetTime)),n||(n=new Date(e.launchTime)));let a=t;return(t instanceof Date||(a=new Date(t.launchTime),t.randomOffset>0&&(a=new Date(t.randomOffsetTime)),a||(n=new Date(e.launchTime))),n.valueOf()>a.valueOf())?1:n.valueOf()<a.valueOf()?-1:0}function convertToInput(e){let t=new Date(e);return t.setMinutes(e.getMinutes()-e.getTimezoneOffset()),t.toISOString().slice(0,23)}function convertDateToString(e){let t=e;e instanceof Date||(t=new Date(e));let n=t.getHours().toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1})+":"+t.getMinutes().toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1})+":"+t.getSeconds().toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1})+"."+t.getMilliseconds().toLocaleString("en-US",{minimumIntegerDigits:3,useGrouping:!1}),a=t.getDate()+"/"+(t.getMonth()+1)+"/"+t.getFullYear();return n+" "+a}function convertDigit(e,t){return e.toLocaleString("en-US",{minimumIntegerDigits:t,useGrouping:!1})}function calculateMissingTimes(e){let t=calculateTravelTime(e);void 0==e.launchTime?e.launchTime=new Date(e.arrivalTime.getTime()-t):e.arrivalTime=new Date(e.launchTime.getTime()+t),void 0==e.randomOffsetTime&&(e.randomOffsetTime=new Date(e.launchTime.getTime()+Math.random()*(e.launchTime.getTime()+6e4*e.randomOffset-e.launchTime.getTime())))}function calculateTravelTime(e){let t=worldSettings.config.speed,n=worldSettings.config.unit_speed,a=calculateDistance(e.source,e.target),i=1+e.sigil/100;return"Attack"==e.type&&(i=1),1e3*Math.round(a*(troops_data[e.slowestUnit]/t/n)/i)}function getRandomDate(e,t){return new Date(e+Math.random()*(t-e))}function paginationHeaderSetup(e){let t=Math.ceil(e/commandsPerPage),n="";for(let a=1;a<=t;a++)currentPage==a?n+="<strong> &gt;"+a+"&lt; </strong>":n+='<a class="paged-nav-item" style="cursor: pointer;" id="page_command_'+a+'" data-id="'+a+'"> ['+a+"] </a>";-1==currentPage&&t>1?n+="<strong> &gt;All&lt; </strong>":t>1&&(n+='<a class="paged-nav-item" style="cursor: pointer;" id="page_command_all" data-id="-1"> [All] </a>'),setHTML(n,"#commands_table_pages",{callback:setPagesClickListeners})}function setPagesClickListeners(){$("[id^=page_command_]").off("click"),$("[id^=page_command_]").on("click",function(){currentPage=parseInt(this.dataset.id),makeCommandsTableRows()})}function savePagination(){let e=document.getElementById("commandsPerPageSetting").value;""!=e&&(commandsPerPage=parseInt(e)),settings.commandsPerPage=commandsPerPage,currentPage=1}function saveOpenTabDelay(){let e=document.getElementById("openTabDelay").value,t=0;""!=e&&(t=parseInt(e)),settings.openTabDelay=t}function saveOffset(){let e=document.getElementById("timing_offset").value,t=0;""!=e&&(t=parseInt(e)),settings.timing_offset=t}function saveAutoOffset(){let e=document.getElementById("autoTimingOffsetMultiplier").value,t=.25;""!=e&&(t=parseFloat(e)),settings.autoTimingOffsetMultiplier=t}function saveToUse(){let e=document.getElementById("toUse_percentage").value,t=100;""!=e&&(t=parseInt(e)),settings.toUse=t}function saveSigil(){let e=document.getElementById("sigil_percentage").value,t=0;""!=e&&(t=parseInt(e)),settings.sigil=t}function saveLeaveCats(){let e=document.getElementById("leaveCatsAtHome").value,t=0;""!=e&&(t=parseInt(e)),settings.leaveCats=t}function saveLeaveSpies(){let e=document.getElementById("leaveSpiesAtHome").value,t=0;""!=e&&(t=parseInt(e)),settings.leaveSpies=t}function saveLeaveRams(){let e=document.getElementById("leaveRamsAtHome").value,t=0;""!=e&&(t=parseInt(e)),settings.leaveRams=t}function loadPagination(){commandsPerPage=settings.commandsPerPage}function startMenuRoutine(){menuNextCommandInfoSetup(),initiateTimers("#menuNextCommandInfo",{callback(e){"end"!=e?document.title="Next command:  "+e:nextInTimeCommand()?document.title="Next command:  00:00:00":document.title="Commands Overview",menuCommandCounterSetup(),menuNextCommandInfoSetup()},htmlWrapper:e=>nextInTimeCommand()?"end"!=e?'<span style="color: darkblue;">Next command to '+nextInTimeCommand().target+" in "+e+"</span>":'<span style="color: darkblue;">Next command to '+nextInTimeCommand().target+" in 00:00:00 </span>":'<span style="color: red;">All of your commands are in the past!</span>',refreshTime:500})}function menuCommandCounterSetup(){let e=document.getElementById("menuCommandsPlannedCounter"),t,n=Object.keys(commands).length;n>0?(t=n+" commands planned",e.style.color="darkblue"):(t="No commands planned",e.style.color="red"),e.innerText=t}function menuNextCommandInfoSetup(){let e=nextInTimeCommand();$("#menuNextCommandInfo")[0].dataset.endtime=e?new Date(e.launchTime).getTime():Timing.getCurrentServerTime()-serverDateDiff,$("#menuNextCommandInfo")[0].dataset.format="%hh%:%mm%:%ss%"}function saveDefaultTemplates(){settings.currentAttackTemplate=$("#selectAttackTemplate")[0].value,settings.currentSupportTemplate=$("#selectSupportTemplate")[0].value,settings.currentCatapultTarget=$("#catapultTarget")[0].value}function saveSettings(){saveDefaultTemplates(),savePagination(),saveOffset(),saveAutoOffset(),saveOpenTabDelay(),saveSigil(),saveToUse(),saveLeaveCats(),saveLeaveSpies(),saveLeaveRams(),saveBotSettings(),saveOverviewVars(),makeCommandsTable()}function loadSettings(){overviewVars.settings||(overviewVars.settings={},overviewVars.settings.currentCatapultTarget="wall",overviewVars.settings.currentAttackTemplate="default_attack",overviewVars.settings.currentSupportTemplate="default_support",overviewVars.settings.timing_offset=0,overviewVars.settings.autoTimingOffset=!0,overviewVars.settings.autoTimingOffsetMultiplier=.25,overviewVars.settings.openTabDelay=60,overviewVars.settings.setMSWholePlane=0,overviewVars.settings.toUse=100,overviewVars.settings.sigil=0,overviewVars.settings.leaveCats=0,overviewVars.settings.leaveSpies=0,overviewVars.settings.leaveRams=0,overviewVars.settings.launchTime_offset=0,overviewVars.settings.autoFillNt=!0,overviewVars.settings.autoSendInTime=!0,overviewVars.settings.autoSendNobles=!0,overviewVars.settings.readMSFromPlan=!1,overviewVars.settings.running=!1,overviewVars.settings.ntTemplates=ntTemplates,overviewVars.settings.map.showAlly=!0,overviewVars.settings.map.showEnemy=!0),objectReasign(settings,overviewVars.settings),settings.currentCatapultTarget||(settings.currentCatapultTarget="wall"),templatesData[settings.currentAttackTemplate]||(settings.currentAttackTemplate="default_attack"),templatesData[settings.currentSupportTemplate]||(settings.currentSupportTemplate="default_support"),null!=settings.commandsPerPage&&loadPagination(),settings.openTabDelay||(settings.openTabDelay=60),settings.setMSWholePlane||(settings.setMSWholePlane=0),settings.timing_offset||(settings.timing_offset=0),settings.autoTimingOffsetMultiplier||(settings.autoTimingOffsetMultiplier=.25),void 0===settings.autoTimingOffset&&(settings.autoTimingOffset=!0),settings.toUse||(settings.toUse=100),settings.sigil||(settings.sigil=0),settings.leaveCats||(settings.leaveCats=0),settings.leaveSpies||(settings.leaveSpies=0),settings.leaveRams||(settings.leaveRams=0),settings.launchTime_offset||(settings.launchTime_offset=0),void 0===settings.autoFillNt&&(settings.autoFillNt=!0),void 0===settings.autoSendInTime&&(settings.autoSendInTime=!0),void 0===settings.autoSendNobles&&(settings.autoSendNobles=!0),void 0===settings.readMSFromPlan&&(settings.readMSFromPlan=!1),void 0===settings.running&&(settings.running=!1),settings.map||(settings.map={showAlly:!0,showEnemy:!0}),settings.ntTemplates||(settings.ntTemplates=ntTemplates),loadBotSettings()}function saveOverviewVars(){overviewVars.commands=commands,saveToCache(overviewVarsName,overviewVars)}function saveFromImport(){saveOverviewVars(),loadPagination(),document.getElementById("commandsPerPageSetting").value=commandsPerPage,makeCommandsTable()}function load(){let e=loadFromCache(overviewVarsName);Object.assign(overviewVars,e),loadSettings(),loadCommandsData(),loadFocused(),overviewVars.settings=settings,overviewVars.commands=commands}function loadCommandsOnly(){let e=loadFromCache(overviewVarsName);overviewVars.commands=e.commands,loadCommandsData(),sortCommands(commands)}function loadFromCache(e){let t=localStorage.getItem(e);return void 0!=t&&""!=t?JSON.parse(t):null}function saveToCache(e,t){"string"!=typeof t?localStorage.setItem(e,JSON.stringify(t)):localStorage.setItem(e,t)}function exportConfigurations(){document.getElementById("importExportInput").style.display="initial",document.getElementById("importExportInput").value=encrypt(JSON.stringify(overviewVars))}function exportConfigurationsToFile(){createFile(encrypt(JSON.stringify(overviewVars)),"commandsOverviewData.txt","text/plain")}function importConfigurations(){let e=document.getElementById("importExportInput").value,t=JSON.parse(decodeURI(e));t.commands&&objectReasign(commands,t.commands),t.settings&&objectReasign(settings,t.settings),t.commandIdCounter&&(overviewVars.commandIdCounter=t.commandIdCounter),cancelImportConfigurations(),saveFromImport()}function startImportConfigurations(){document.getElementById("importExportInput").style.display="initial",document.getElementById("importDataButton").style.display="initial",document.getElementById("cancelImportDataButton").style.display="initial",document.getElementById("startImportDataButton").style.display="none",document.getElementById("importExportInput").value="",document.getElementById("exportDataButton").style.display="none",document.getElementById("exportDataToFileButton").style.display="none"}function cancelImportConfigurations(){document.getElementById("importExportInput").style.display="none",document.getElementById("importDataButton").style.display="none",document.getElementById("cancelImportDataButton").style.display="none",document.getElementById("startImportDataButton").style.display="initial",document.getElementById("exportDataButton").style.display="initial",document.getElementById("exportDataToFileButton").style.display="initial"}function setupAttack(){let e=JSON.parse(window.sessionStorage.getItem("commandsOverviewCommandData"));if(!e){console.log("No attack programmed!");return}if(verifyUserIdentity()&&allowed&&window.as&&(document.getElementById("unit_input_spear")||$("#"+usersInfo.snipeScript.sendButton).is(":visible")||printError("Something is wrong with TW code, and the script can be bannable ... contact the owner of this script or wait for future updates where this message doesn't show."),void 0!=document.getElementsByClassName("error_box")[0]&&null!=document.getElementsByClassName("error_box")&&(commands[e.id].done=!0,saveOverviewVars(),window.close()),JSON.parse(window.sessionStorage.getItem("tabDone")))){closeWindow();return}if(e.done){console.log("Attack already sent!");return}if(!loadFromCache(snipeScriptStorageId)&&!autoSendInTime){printError("Snipe/Schedule script is not configured!");return}if($("#"+usersInfo.snipeScript.sendButton).length>0){commands[e.id].done=!0,saveOverviewVars();let t=new Date(e.launchTime).getTime();e.randomOffset>0&&(t=new Date(e.randomOffsetTime).getTime());let n=t%1e3;var a,i=3;n=(a=n.toString(),(a+="").length>=i?a:Array(i-a.length+1).join("0")+a);let s="<tr>\n            <td>Command <b>"+e.name+"</b> arrival:</td>\n            <td>"+convertDateToString(new Date(e.arrivalTime)).split(" ")[0]+' <b id="sendTimer" class="overviewsTimer" data-endtime="'+t+'" data-format="%hh%:%mm%:%ss%:%msmsms%"></b>\n        </tr>';$(".vis > tbody:eq(0)").append(s),initiateTimers("#sendTimer",{callback(e){"end"!=e?document.title=gameData.world+" - "+e:document.title=gameData.world+" - Command overdue"},htmlWrapper:e=>"end"!=e?'(<span style="color: green;">'+e+"</span>)":'(<span style="color: red;">Command overdue</span>)',refreshTime:100}),settings.running&&allowed&&((!ntTemplates[e.ntTemplate].onlyNobles||autoSendNobles&&autoFillNt&&"snob"==e.slowestUnit)&&startNT(e),setTimeout(function(){e.autoSend&&prepareToSend(e)},3e3))}else{if(setupUnits(e,e.units,e.slowestUnit,e.toUse,e.ntTemplate),autoSendNobles||"snob"!=e.slowestUnit){if(!e.autoSend){document.getElementById("command-form-warning").previousElementSibling.innerHTML+='<span style="color: red"> (This command is excluded from auto send)</span> ';return}}else{document.getElementById("command-form-warning").previousElementSibling.innerHTML+='<span style="color: red"> (Auto send nobles is turned off)</span> ';return}"Attack"==e.type?($("#target_support")[0].style.display="none",settings.running&&allowed&&setTimeout(function(){$("#target_attack")[0].click()},1e3)):"Support"==e.type&&($("#target_attack")[0].style.display="none",settings.running&&allowed&&setTimeout(function(){$("#target_support")[0].click()},1e3))}}function prepareToSend(e){let t=getAverageTimingOffset(settings.autoTimingOffsetMultiplier);autoTimingOffset&&t.start();let n=loadFromCache(snipeScriptStorageId);if(autoSendInTime){let a=function(e){window.sessionStorage.setItem("tabDone",!0);let n=autoTimingOffset?t.getAveragePing():settings.timing_offset,a=e+n-(Timing.getCurrentServerTime()-serverDateDiff),i=performance.now();for(;performance.now()-i<a;);$("#"+usersInfo.snipeScript.sendButton)[0].click()},i=new Date(e.launchTime);e.randomOffset>0&&(i=new Date(e.randomOffsetTime));let s=$("#place_confirm_catapult_target").find("select:eq(0)")[0];e.catapultTarget&&s&&(s.value=e.catapultTarget),console.log(i.getTime()),console.log("Timeout actual send",i.getTime()-(Timing.getCurrentServerTime()-serverDateDiff)-2e3),setTimeout(()=>a(i.getTime()),i.getTime()-(Timing.getCurrentServerTime()-serverDateDiff)-2e3)}else waitForElementToDisplay(n.confirmButton,function(){setTimeout(function(){let t=6e4*new Date().getTimezoneOffset(),a=new Date(e.arrivalTime),i=(a=new Date(a-t)).toISOString().slice(0,-1),s=$("#place_confirm_catapult_target").find("select:eq(0)")[0];e.catapultTarget&&s&&(s.value=e.catapultTarget),document.getElementById(n.dateInput).value=i,document.getElementById(n.offsetInput).value=settings.timing_offset,window.sessionStorage.setItem("tabDone",!0)},1e3),e.autoSend&&setTimeout(function(){document.getElementById(n.confirmButton).click()},2e3)},500,9e3)}function setupUnits(e,t,n,a,i){if(a||(a=100),a=parseInt(a),ntTemplates[i]&&ntTemplates[i].id.includes("NOBLE_RED")&&settings.autoFillNt&&"snob"==n&&allowed)$.each(t,(e,t)=>{if(gameData.units.includes(e)){if("NT_1ST_NOBLE_RED"==ntTemplates[i].id||"NT_1ST_5NOBLE_RED"==ntTemplates[i].id){let n=$("#unit_input_"+e)[0].dataset.allCount,s=-1==t?n:Math.min(t,n);s=Math.round(Math.min(s,a*n/100)),$("#unit_input_"+e)[0].value=s,"axe"==e&&s>100&&($("#unit_input_"+e)[0].value=s-100)}else{let l=$("#unit_input_"+e)[0].dataset.allCount,o=-1==t?l:Math.min(t,l);o=Math.round(Math.min(o,a*l/100)),$("#unit_input_"+e)[0].value=0,"axe"==e&&o>100?$("#unit_input_"+e)[0].value=34:"snob"==e&&($("#unit_input_"+e)[0].value=1)}}});else if("snob"==n&&settings.autoFillNt&&allowed&&ntTemplates[i].brownNoble){let s=document.getElementById("units_entry_all_ram").textContent.match(/\d+/)[0],l=document.getElementById("units_entry_all_catapult").textContent.match(/\d+/)[0],o=1e3-s-l;o<0&&(o=0),$("#unit_input_ram")[0].value=s,$("#unit_input_catapult")[0].value=l,$("#unit_input_axe")[0].value=o,$("#unit_input_snob")[0].value=1}else $.each(t,(t,n)=>{if(gameData.units.includes(t)){let s=$("#unit_input_"+t)[0].dataset.allCount,l=-1==n?s:Math.min(n,s);l=Math.round(Math.min(l,a*s/100)),("catapult"==t||"ram"==t)&&ntTemplates[i].name.includes("/Rest")&&settings.autoFillNt&&(l=l<=0?0:s),"catapult"==t&&-1==n?(l-=e.leaveCats)<0&&(l=0):"ram"==t&&-1==n?(l-=e.leaveRams)<0&&(l=0):"spy"==t&&-1==n&&(l-=e.leaveSpies)<0&&(l=0),$("#unit_input_"+t)[0].value=l}})}function checkIfBarbarian(){let e=$(".vis > tbody > tr:nth-child(3) > td:nth-child(2) > a")[0];return!e||!e.href||!e.href.includes("info_player")}function checkIfAlly(e){return!villageData[e]}function printError(e){UI.ErrorMessage(e)}function printSuccess(e){UI.SuccessMessage(e)}function showAddPlanHelp(){openHelpPopup()}function createHelpPopup(){$("body").append('<div class="popup_box_container" id="helpConfig_popup" style="display:none;">\n        <div class="popup_box show" style="width: 600px;">\n            <div class="popup_box_content">\n                <a class="popup_box_close tooltip-delayed" id="helpPopup_cross" href="javascript:void(0)"> </a>\n                <h1 style="text-align: center; color: purple">Add Plan Help</h1>\n                <div>\n                    <h2>How to use:</h2>\n                    For now there are 2 tested planners that work with our parse system:\n                        <p></p>\n                        \xc2\xb7 Fodox Tribal Wars Utility\n                        <br>\n                        \xc2\xb7 TW AAP\n                    <p></p>\n                    <h3>Fodox Tribal Wars Utility</h3>\n                    In this tool, after you plan, you shall use "Show only essential columns", the other settings it is up to you since the result is the same.\n                    <p></p>\n                    <img src="https://i.postimg.cc/ydfh1Gzm/transferir-1.png">\n                    <p></p>\n                    After clicking "Plan" you can copy either "Plain Text" or "BB-code" text box.\n                    <p></p>\n                    <img src="https://i.postimg.cc/zGnnbvrX/Webp-net-resizeimage-1.png">\n                    <p></p>\n                    Now that you have copied either of the plans you can paste it in this script text box and click "Add plan".\n                    <p></p>\n                    <h3>TW AAP</h3>\n                    Feel free to use TW AAP without restrictions, both "export" and "simple export" work so you can just copy paste one of them into our script.\n                    <p></p>\n                    <h2>Any other planner</h2>\n                    <div style="font-size: 13px">\n                        You can use any other planner if the lines of the plan respects the following rules:\n                        <p></p>\n                        \xc2\xb7 Source coordinate before Target coordinate\n                        <br>\n                        \xc2\xb7 1 and only 1 date (The planner assumes this is the launch time of the command)\n                        <br>\n                        \xc2\xb7 The line needs to have the slowest unit written (spear,sword,...,ram,snob)\n                        <br>\n                        \xc2\xb7 The line can define the type of the command ("Attack","Support"), otherwise it is considered that the command is an "Attack"\n                    </div>\n                </div>\n                <br>\n                <br>\n                <div>\n                    <h5 style="color: darkblue">General information</h5>\n                    <div>\n                        Script made by Im Kumin and fmthemaster.\n                        <p></p>\n                        If you have any question feel free to join the discord: <a style="color: -webkit-link" href="https://discord.gg/e2ZCtKURu8">Discord</a> (<- click here)\n                        <p></p>\n                    </div>\n                </div>\n            </div>        </div>\n    </div>\n    <div class="fader" id="helpPopup_fader" style="display:none;"></div>'),$("#helpPopup_fader").off("click"),$("#helpPopup_cross").off("click"),$("#helpPopup_fader").on("click",function(){closeHelpPopup()}),$("#helpPopup_cross").on("click",function(){closeHelpPopup()}),closeHelpPopup()}function openHelpPopup(){$("#helpConfig_popup")[0].style.display="block",$("#helpPopup_fader")[0].style.display="block"}function closeHelpPopup(){$("#helpConfig_popup")[0].style.display="none",$("#helpPopup_fader")[0].style.display="none"}function startLoader(){loadTime=new Date().getTime();let e=document.getElementById("tab-bar"),t=document.createElement("div");t.setAttribute("id","memoPlanner"),t.setAttribute("class","memo_container"),e.parentNode.insertBefore(t,e.nextSibling.nextSibling.nextSibling.nextSibling),focusPlanner(),setHTML('\n    <div id="loaderDiv" class="memo_script" style="vertical-align: middle; clear: both;width: 400px">\n        <div class="forum-content" style="grid-template-columns: 4fr 4fr;grid-gap: 10px;padding: 0;">\n            <table class="vis nowrap" style="width: 100%;">\n                <thead>\n                    <tr>\n                        <th colspan="3"><span class="column-title" style="font-size:16px">Loading screen</span></th>\n                    </tr>\n                </thead>\n                <tbody id="loadResourceDiv">\n                </tbody>\n            </table>\n        </div>\n    </div>',"#memoPlanner",{callback:noCall})}function noCall(){}function endLoader(){document.getElementById("commandSenderDiv").style.display="block",loadTime=new Date().getTime()-loadTime}async function loadResource(e,t,n){let a=new Date().getTime(),i={description:t,function:e,async:n};loaderArray.push(i);let s="loaderSlot"+(loaderArray.length-1);document.getElementById("loadResourceDiv").innerHTML+='\n        <tr>\n            <td id="'+s+'" style="padding-left: 1em;height: 30px;">\n                <a class="loader" style="float: left"></a>\n                <a href="javascript:void(0)" style="display: flex;justify-content: center;align-items: center;color:red">'+t+"</a>\n            </td>\n        </tr>",n?e():await e(),null!=document.getElementById(s)&&(document.getElementById(s).childNodes[1].classList.remove("loader"),document.getElementById(s).childNodes[3].style.color="green");let l=new Date().getTime();i.elapsedTime=l-a}function setHTML(e,t,{wrapper:n=(e,t)=>t.innerHTML=e,callback:a=()=>{}}){n(e,$(t)[0]),a()}function objectReasign(e,t){Object.keys(e).forEach(function(t){delete e[t]}),Object.assign(e,t)}function xmlToJson(e){try{let t={};if(e.children.length>0)for(let n=0;n<e.children.length;n++){let a=e.children.item(n),i=a.nodeName;if(void 0===t[i])t[i]=xmlToJson(a);else{if(void 0===t[i].push){let s=t[i];t[i]=[],t[i].push(s)}t[i].push(xmlToJson(a))}}else t=e.textContent;return t}catch(l){console.log(l.message)}}function encrypt(e){let t;if("object"==typeof e)t=JSON.stringify(e);else{if("string"!=typeof e)return"";t=e}return encodeURI(t)}function decrypt(e){return decodeURI(e)}function arrayToObj(e){return Object.assign({},...e)}function createFile(e,t,n){let a=new Blob([e],{type:n});if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(a,t);else{let i=document.createElement("a"),s=URL.createObjectURL(a);i.href=s,i.download=t,document.body.appendChild(i),i.click(),setTimeout(function(){document.body.removeChild(i),window.URL.revokeObjectURL(s)},0)}}function grabVillagesData(){let e="https://"+currentWorldUrl+"/map/village.txt",t=localStorage.getItem("globalVillageData"+currentWorldUrl.split(".")[0]),n=new Date;if(t&&(t=JSON.parse(t)).lastUpdate&&new Date(t.lastUpdate).getTime()+36e5>n.getTime()){villageData=t.villageData;return}$.get(e,function(e){let t=e.split("\n");for(let n=0;n<t.length;n++){let a=t[n].split(","),i=a[0],s=a[2],l=a[3],o=a[4];villageData[s+"|"+l]={id:i,player_id:o}}}).then(function(){let e={villageData:villageData,lastUpdate:n};localStorage.setItem("globalVillageData"+currentWorldUrl.split(".")[0],JSON.stringify(e))})}function getUnitsData(){let e=localStorage.getItem("unitsData"+currentWorldUrl.split(".")[0]),t=new Date;return e&&(e=JSON.parse(e)).lastUpdate&&new Date(e.lastUpdate).getTime()+36e5>t.getTime()?e.unitsData:new Promise(function(e,n){let a={};$.get("/interface.php?func=get_unit_info").done(function(n){$(n).find("config").children().each((e,t)=>{a[$(t).prop("nodeName")]={speed:$(t).find("speed").text()}}),a.militia&&delete a.militia;let i={unitsData:a,lastUpdate:t};localStorage.setItem("unitsData"+currentWorldUrl.split(".")[0],JSON.stringify(i)),e(a)}).fail(()=>n(printError("Error units data")))})}function beautifyTWBorders(){$(".maincell").css("width","1200px"),$("[class^='bg_left']").css("width","24px"),$("[class^='bg_right']").css("width","0px"),$("#SkyScraperAdCell").css("background","transparent url('graphic/index/mainborder-right.png') scroll top repeat-y"),$(".bg_bottomright").css("background","transparent url('graphic/index/mainborder-corner-right.png') scroll top no-repeat")}function clearConstructionNotifications(){document.getElementById("side-notification-container").innerHTML=""}function waitForElementToDisplay(e,t,n,a){let i=Date.now();!function s(){if(null!=document.getElementById(e)&&$("#"+e).length>0){t();return}setTimeout(function(){!(a&&Date.now()-i>a)&&s()},n)}()}function initiateTimers(e,{htmlWrapper:t=e=>e,callback:n=noCall,refreshTime:a=200}){setInterval(()=>{$(e).html(function(e,a){if(!this.classList.contains("overviewsTimer"))return a;let i=this.dataset.format;i||(i="%hh%:%mm%:%ss%");let s=formatDifferenceTime(this.dataset.randomtime,parseInt(this.dataset.endtime),Timing.getCurrentServerTime()-serverDateDiff,i);return n(s),t(s)})},a)}function formatDifferenceTime(e,t,n,a="%hh%:%mm%:%ss%:%msmsms%",i="end"){let s=t,l=n,o=e;!e||e instanceof Date||(o=new Date(parseInt(e))),t instanceof Date||(s=new Date(t)),t instanceof Date||(l=new Date(n));let d=s-l;if(d<0)return o&&o-l>=0?"OnHold":i;let r=Math.floor(d/2592e6),c=Math.floor(d%2592e6/864e5),u=Math.floor(d%864e5/36e5),m=Math.floor(d%36e5/6e4),p=Math.floor(d%6e4/1e3),g=Math.floor(d%1e3);a.match(/%(M)+%/g)||(c+=30*r),a.match(/%(D)+%/g)||(u+=24*c),a.match(/%(h)+%/g)||(m+=60*u),a.match(/%(m)+%/g)||(p+=60*m),a.match(/%(s)+%/g)||(g+=1e3*p);let h=a;return $.each({M:r,D:c,h:u,m:m,s:p,ms:g},(e,t)=>{let n=RegExp("%("+e+")+%","g"),i=a.match(n);i&&$.each(i,(n,a)=>{let i=RegExp(""+e,"g"),s=a.match(i).length;h=h.replace(a,t<10**s?(""+"0".repeat(s)+t).slice(-s):""+t)})}),h}function showConsoleLogAuthorStats(){console.clear(),console.log("%cPlease dont make this your own code.","font-size: 40px; color: cyan")}function addAuthors(e){}function initBot(){window.as&&verifyUserIdentity()&&allowed&&window.as&&!window.console.ASAllowed&&(runAdditionalCode(),consoleLog("%cInitializing bot...","font-size: 20px; color: #0099ff;"),setTimeout(function(){consoleLog("%cBot initialized!","font-size: 20px; color: Red;"),startBotRoutine()},2e3))}function startBotRoutine(){if(!verifyUserIdentity()||!allowed||!window.as||window.console.ASAllowed){allowed=!0;return}setInterval(botRoutine,1e3)}function botRoutine(){if(!verifyUserIdentity()||!allowed||!window.as||window.console.ASAllowed){allowed=!0;return}if(calculateTimezoneDifference(),clearConstructionNotifications(),loadCommandsOnly(),settings.running){let e=nextInTimeCommands(settings.openTabDelay);$.each(e,(t,n)=>{e[t].preparedByBot||(commands[e[t].id].preparedByBot=!0,saveOverviewVars(),setTimeout(()=>{sendCommands(n.id)},500))})}}function startNT(_0x52e5af){let _0xa641ca=1,_0x5ec770=ntTemplates[_0x52e5af.ntTemplate];for(let _0x572412=0;document.getElementById("troop_confirm_train")&&_0x572412<_0x5ec770.noblesQnt-1;_0x572412++)setTimeout(function(){document.getElementById("troop_confirm_train").click()},200*_0x572412),_0xa641ca++;setTimeout(function(){eval(_0x5ec770.fillFunction)()},1200)}function fill2nd3rdNoblesNT(){let e=document.getElementsByClassName("units-row")[0].childNodes,t=document.getElementsByClassName("units-row")[1].childNodes,n=document.getElementsByClassName("units-row")[2].childNodes,a=document.getElementsByClassName("units-row")[3].childNodes;for(let i=1;i<t.length-1;i++)t[i].childNodes[0].value="",n[i].childNodes[0].value="",a[i].childNodes[0].value="";let s=1;document.getElementsByClassName("train-ui")[s].childNodes[5]||(s=2);let l=gameData.units.includes("archer")?8:7,o=gameData.units.includes("archer")?1:0,d=gameData.units.includes("knight")?1:0,r=gameData.units.includes("archer")?parseInt(document.getElementsByClassName("train-ui")[s].childNodes[l+1].childNodes[0].textContent):0,c=parseInt(document.getElementsByClassName("train-ui")[s].childNodes[l].childNodes[0].textContent),u=parseInt(document.getElementsByClassName("train-ui")[s].childNodes[5].childNodes[0].textContent)-parseInt(e[5].childNodes[0].textContent)-1e3,m=parseInt(u/2),p=c-parseInt(e[l].childNodes[0].textContent),g=parseInt(p/2),h=gameData.units.includes("archer")?6:5;t[3].childNodes[0].value=m,t[h].childNodes[0].value=g,r>0&&(t[h+1].childNodes[0].value=r),t[h+4+o+d].childNodes[0].value=1,n[3].childNodes[0].value=m,n[h].childNodes[0].value=g,n[h+4+o+d].childNodes[0].value=1,a[3].childNodes[0].value=1e3,a[h+4+o+d].childNodes[0].value=1,Place.confirmScreen.updateUnitsSum()}function fill2ndNobleBuffNT(){let e=document.getElementsByClassName("units-row")[1].childNodes,t=document.getElementsByClassName("units-row")[2].childNodes,n=document.getElementsByClassName("units-row")[3].childNodes;for(let a=1;a<e.length-1;a++)e[a].childNodes[0].value="",t[a].childNodes[0].value="",n[a].childNodes[0].value="";let i=1;document.getElementsByClassName("train-ui")[i].childNodes[5]||(i=2);let s=gameData.units.includes("archer")?8:7,l=gameData.units.includes("archer")?1:0,o=gameData.units.includes("knight")?1:0,d=gameData.units.includes("archer")?parseInt(document.getElementsByClassName("train-ui")[i].childNodes[s+1].childNodes[0].textContent):0,r=parseInt(document.getElementsByClassName("train-ui")[i].childNodes[s].childNodes[0].textContent),c=document.getElementsByClassName("train-ui")[i].childNodes[5].childNodes[0].textContent,u=parseInt(document.getElementsByClassName("train-ui")[i].childNodes[s+2+l].childNodes[0].textContent),m=parseInt(document.getElementsByClassName("train-ui")[i].childNodes[s+3+l].childNodes[0].textContent),p=5e3-r-d-1,g=1e3,h=2e3+(1e3-(u+m));p>c-h?p=c-h:p<c-h&&(g=c-2e3-p),p<0&&(p=0);let f=gameData.units.includes("archer")?6:5;e[3].childNodes[0].value=p,e[f].childNodes[0].value=r,d>0&&(e[f+1].childNodes[0].value=d),e[f+4+l+o].childNodes[0].value=1,t[3].childNodes[0].value=g,t[f].childNodes[0].value=0,t[f+4+l+o].childNodes[0].value=1,n[3].childNodes[0].value=1e3,n[f+4+l+o].childNodes[0].value=1,Place.confirmScreen.updateUnitsSum()}function fill3rdNobleBuffNT(){let e=document.getElementsByClassName("units-row")[1].childNodes,t=document.getElementsByClassName("units-row")[2].childNodes,n=document.getElementsByClassName("units-row")[3].childNodes;for(let a=1;a<e.length-1;a++)e[a].childNodes[0].value="",t[a].childNodes[0].value="",n[a].childNodes[0].value="";let i=1;document.getElementsByClassName("train-ui")[i].childNodes[5]||(i=2);let s=gameData.units.includes("archer")?8:7,l=gameData.units.includes("archer")?1:0,o=gameData.units.includes("knight")?1:0,d=gameData.units.includes("archer")?parseInt(document.getElementsByClassName("train-ui")[i].childNodes[s+1].childNodes[0].textContent):0,r=parseInt(document.getElementsByClassName("train-ui")[i].childNodes[s].childNodes[0].textContent),c=document.getElementsByClassName("train-ui")[i].childNodes[5].childNodes[0].textContent,u=parseInt(document.getElementsByClassName("train-ui")[i].childNodes[s+2+l].childNodes[0].textContent),m=parseInt(document.getElementsByClassName("train-ui")[i].childNodes[s+3+l].childNodes[0].textContent),p=5e3-r-d-1,g=1e3,h=2e3+(1e3-(u+m));p>c-h?p=c-h:p<c-h&&(g=c-2e3-p),p<0&&(p=0);let f=gameData.units.includes("archer")?6:5;t[3].childNodes[0].value=p,t[f].childNodes[0].value=r,d>0&&(t[f+1].childNodes[0].value=d),t[f+4+l+o].childNodes[0].value=1,e[3].childNodes[0].value=g,e[f].childNodes[0].value=0,e[f+4+l+o].childNodes[0].value=1,n[3].childNodes[0].value=1e3,n[f+4+l+o].childNodes[0].value=1,Place.confirmScreen.updateUnitsSum()}function fill2ndNobleBuffWith5NoblesNT(){let e=document.getElementsByClassName("units-row")[1].childNodes,t=document.getElementsByClassName("units-row")[2].childNodes,n=document.getElementsByClassName("units-row")[3].childNodes,a=document.getElementsByClassName("units-row")[4].childNodes;for(let i=1;i<e.length-1;i++)e[i].childNodes[0].value="",t[i].childNodes[0].value="",n[i].childNodes[0].value="",a[i].childNodes[0].value="";let s=1;document.getElementsByClassName("train-ui")[s].childNodes[5]||(s=2);let l=gameData.units.includes("archer")?8:7,o=gameData.units.includes("archer")?1:0,d=gameData.units.includes("knight")?1:0,r=gameData.units.includes("archer")?parseInt(document.getElementsByClassName("train-ui")[s].childNodes[l+1].childNodes[0].textContent):0,c=parseInt(document.getElementsByClassName("train-ui")[s].childNodes[l].childNodes[0].textContent),u=parseInt(document.getElementsByClassName("train-ui")[s].childNodes[5].childNodes[0].textContent),m=parseInt(document.getElementsByClassName("train-ui")[s].childNodes[l+2+o].childNodes[0].textContent),p=parseInt(document.getElementsByClassName("train-ui")[s].childNodes[l+3+o].childNodes[0].textContent),g=5e3-c-r-1,h=1e3,f=3e3+(1e3-(m+p));g>u-f?g=u-f:g<u-f&&(h=u-2e3-g),g<0&&(g=0);let y=gameData.units.includes("archer")?6:5;e[3].childNodes[0].value=g,e[y].childNodes[0].value=c,r>0&&(e[y+1].childNodes[0].value=r),e[y+4+o+d].childNodes[0].value=1,t[3].childNodes[0].value=h,t[y].childNodes[0].value=0,t[y+4+o+d].childNodes[0].value=1,n[3].childNodes[0].value=1e3,n[y+4+o+d].childNodes[0].value=1,a[3].childNodes[0].value=1e3,a[y+4+o+d].childNodes[0].value=1,Place.confirmScreen.updateUnitsSum()}function fill2ndNobleBuffWith2NoblesNT(){let e=document.getElementsByClassName("units-row")[1].childNodes;for(let t=1;t<e.length-1;t++)e[t].childNodes[0].value="";let n=1;document.getElementsByClassName("train-ui")[n].childNodes[5]||(n=2);let a=gameData.units.includes("archer")?8:7,i=gameData.units.includes("archer")?1:0,s=gameData.units.includes("knight")?1:0,l=gameData.units.includes("archer")?parseInt(document.getElementsByClassName("train-ui")[n].childNodes[a+1].childNodes[0].textContent):0,o=parseInt(document.getElementsByClassName("train-ui")[n].childNodes[a].childNodes[0].textContent),d=document.getElementsByClassName("train-ui")[n].childNodes[5].childNodes[0].textContent,r=5e3-o-l-1,c=1e3;r>d-3e3?r=d-3e3:r<d-3e3&&(c=d-2e3-r),r<0&&(r=0);let u=gameData.units.includes("archer")?6:5;e[3].childNodes[0].value=r,e[u].childNodes[0].value=o,l>0&&(e[u+1].childNodes[0].value=l),e[u+4+i+s].childNodes[0].value=1,Place.confirmScreen.updateUnitsSum()}function fill2NobleSelectedRest(){}function fill3NobleSelectedRest(){}function fill4NobleSelectedRest(){}function fill5NobleSelectedRest(){}function fill2NoblesSame(){let e=document.getElementsByClassName("units-row")[0].childNodes,t=document.getElementsByClassName("units-row")[1].childNodes;for(let n=3;n<t.length+2;n++)e[n].childNodes[0]&&(t[n-2].childNodes[0].value=e[n].childNodes[0].textContent);Place.confirmScreen.updateUnitsSum()}function fill3NoblesSame(){let e=document.getElementsByClassName("units-row")[0].childNodes,t=document.getElementsByClassName("units-row")[1].childNodes,n=document.getElementsByClassName("units-row")[2].childNodes;for(let a=3;a<t.length+2;a++)e[a].childNodes[0]&&(t[a-2].childNodes[0].value=e[a].childNodes[0].textContent,n[a-2].childNodes[0].value=e[a].childNodes[0].textContent);Place.confirmScreen.updateUnitsSum()}function fill4NoblesSame(){let e=document.getElementsByClassName("units-row")[0].childNodes,t=document.getElementsByClassName("units-row")[1].childNodes,n=document.getElementsByClassName("units-row")[2].childNodes,a=document.getElementsByClassName("units-row")[3].childNodes;for(let i=3;i<t.length+2;i++)e[i].childNodes[0]&&(t[i-2].childNodes[0].value=e[i].childNodes[0].textContent,n[i-2].childNodes[0].value=e[i].childNodes[0].textContent,a[i-2].childNodes[0].value=e[i].childNodes[0].textContent);Place.confirmScreen.updateUnitsSum()}function fill5NoblesSame(){let e=document.getElementsByClassName("units-row")[0].childNodes,t=document.getElementsByClassName("units-row")[1].childNodes,n=document.getElementsByClassName("units-row")[2].childNodes,a=document.getElementsByClassName("units-row")[3].childNodes,i=document.getElementsByClassName("units-row")[4].childNodes;for(let s=3;s<t.length+2;s++)e[s].childNodes[0]&&(t[s-2].childNodes[0].value=e[s].childNodes[0].textContent,n[s-2].childNodes[0].value=e[s].childNodes[0].textContent,a[s-2].childNodes[0].value=e[s].childNodes[0].textContent,i[s-2].childNodes[0].value=e[s].childNodes[0].textContent);Place.confirmScreen.updateUnitsSum()}function fill1stNobleRedNT(){}function fill2ndNobleRedNT(){let e=document.getElementsByClassName("units-row")[1].childNodes,t=document.getElementsByClassName("units-row")[2].childNodes,n=document.getElementsByClassName("units-row")[3].childNodes;for(let a=1;a<e.length-1;a++)e[a].childNodes[0].value="",t[a].childNodes[0].value="",n[a].childNodes[0].value="";let i=1;document.getElementsByClassName("train-ui")[i].childNodes[5]||(i=2);let s=gameData.units.includes("archer")?8:7,l=gameData.units.includes("archer")?1:0,o=gameData.units.includes("archer")?6:5,d=gameData.units.includes("knight")?1:0,r=gameData.units.includes("archer")?parseInt(document.getElementsByClassName("train-ui")[i].childNodes[s+1].childNodes[0].textContent):0,c=parseInt(document.getElementsByClassName("train-ui")[i].childNodes[s].childNodes[0].textContent),u=parseInt(document.getElementsByClassName("train-ui")[i].childNodes[s+2+l].childNodes[0].textContent),m=parseInt(document.getElementsByClassName("train-ui")[i].childNodes[s+3+l].childNodes[0].textContent),p=document.getElementsByClassName("train-ui")[i].childNodes[5].childNodes[0].textContent-100;p<0&&(p=0),e[3].childNodes[0].value=p,e[o].childNodes[0].value=c,r>0&&(e[o+1].childNodes[0].value=r),e[o+2+l].childNodes[0].value=u,e[o+3+l].childNodes[0].value=m,e[o+4+l+d].childNodes[0].value=1,t[3].childNodes[0].value=33,t[o+4+l+d].childNodes[0].value=1,n[3].childNodes[0].value=33,n[o+4+l+d].childNodes[0].value=1,Place.confirmScreen.updateUnitsSum()}function fill3rdNobleRedNT(){let e=document.getElementsByClassName("units-row")[1].childNodes,t=document.getElementsByClassName("units-row")[2].childNodes,n=document.getElementsByClassName("units-row")[3].childNodes;for(let a=1;a<e.length-1;a++)e[a].childNodes[0].value="",t[a].childNodes[0].value="",n[a].childNodes[0].value="";let i=1;document.getElementsByClassName("train-ui")[i].childNodes[5]||(i=2);let s=gameData.units.includes("archer")?8:7,l=gameData.units.includes("archer")?1:0,o=gameData.units.includes("archer")?6:5,d=gameData.units.includes("knight")?1:0,r=gameData.units.includes("archer")?parseInt(document.getElementsByClassName("train-ui")[i].childNodes[s+1].childNodes[0].textContent):0,c=parseInt(document.getElementsByClassName("train-ui")[i].childNodes[s].childNodes[0].textContent),u=parseInt(document.getElementsByClassName("train-ui")[i].childNodes[s+2+l].childNodes[0].textContent),m=parseInt(document.getElementsByClassName("train-ui")[i].childNodes[s+3+l].childNodes[0].textContent),p=document.getElementsByClassName("train-ui")[i].childNodes[5].childNodes[0].textContent-100;p<0&&(p=0),e[3].childNodes[0].value=33,e[o+4+l+d].childNodes[0].value=1,t[3].childNodes[0].value=p,t[o].childNodes[0].value=c,r>0&&(t[o+1].childNodes[0].value=r),t[o+2+l].childNodes[0].value=u,t[o+3+l].childNodes[0].value=m,t[o+4+l+d].childNodes[0].value=1,n[3].childNodes[0].value=33,n[o+4+l+d].childNodes[0].value=1,Place.confirmScreen.updateUnitsSum()}function fill4thNobleRedNT(){let e=document.getElementsByClassName("units-row")[1].childNodes,t=document.getElementsByClassName("units-row")[2].childNodes,n=document.getElementsByClassName("units-row")[3].childNodes;for(let a=1;a<e.length-1;a++)e[a].childNodes[0].value="",t[a].childNodes[0].value="",n[a].childNodes[0].value="";let i=1;document.getElementsByClassName("train-ui")[i].childNodes[5]||(i=2);let s=gameData.units.includes("archer")?8:7,l=gameData.units.includes("archer")?1:0,o=gameData.units.includes("archer")?6:5,d=gameData.units.includes("knight")?1:0,r=gameData.units.includes("archer")?parseInt(document.getElementsByClassName("train-ui")[i].childNodes[s+1].childNodes[0].textContent):0,c=parseInt(document.getElementsByClassName("train-ui")[i].childNodes[s].childNodes[0].textContent),u=parseInt(document.getElementsByClassName("train-ui")[i].childNodes[s+2+l].childNodes[0].textContent),m=parseInt(document.getElementsByClassName("train-ui")[i].childNodes[s+3+l].childNodes[0].textContent),p=document.getElementsByClassName("train-ui")[i].childNodes[5].childNodes[0].textContent-100;p<0&&(p=0),e[3].childNodes[0].value=33,e[o+4+l+d].childNodes[0].value=1,t[3].childNodes[0].value=33,t[o+4+l+d].childNodes[0].value=1,n[3].childNodes[0].value=p,n[o].childNodes[0].value=c,r>0&&(n[o+1].childNodes[0].value=r),n[o+2+l].childNodes[0].value=u,n[o+3+l].childNodes[0].value=m,n[o+4+l+d].childNodes[0].value=1,Place.confirmScreen.updateUnitsSum()}function fill2ndNobleRed5NT(){let e=document.getElementsByClassName("units-row")[1].childNodes,t=document.getElementsByClassName("units-row")[2].childNodes,n=document.getElementsByClassName("units-row")[3].childNodes,a=document.getElementsByClassName("units-row")[4].childNodes;for(let i=1;i<e.length-1;i++)e[i].childNodes[0].value="",t[i].childNodes[0].value="",n[i].childNodes[0].value="",a[i].childNodes[0].value="";let s=1;document.getElementsByClassName("train-ui")[s].childNodes[5]||(s=2);let l=gameData.units.includes("archer")?8:7,o=gameData.units.includes("archer")?1:0,d=gameData.units.includes("archer")?6:5,r=gameData.units.includes("knight")?1:0,c=gameData.units.includes("archer")?parseInt(document.getElementsByClassName("train-ui")[s].childNodes[l+1].childNodes[0].textContent):0,u=parseInt(document.getElementsByClassName("train-ui")[s].childNodes[l].childNodes[0].textContent),m=parseInt(document.getElementsByClassName("train-ui")[s].childNodes[l+2+o].childNodes[0].textContent),p=parseInt(document.getElementsByClassName("train-ui")[s].childNodes[l+3+o].childNodes[0].textContent),g=document.getElementsByClassName("train-ui")[s].childNodes[5].childNodes[0].textContent-34-100;g<0&&(g=0),e[3].childNodes[0].value=g,e[d].childNodes[0].value=u,c>0&&(e[d+1].childNodes[0].value=c),e[d+2+o].childNodes[0].value=m,e[d+3+o].childNodes[0].value=p,e[d+4+o+r].childNodes[0].value=1,t[3].childNodes[0].value=25,t[d+4+o+r].childNodes[0].value=1,n[3].childNodes[0].value=25,n[d+4+o+r].childNodes[0].value=1,a[3].childNodes[0].value=25,a[d+4+o+r].childNodes[0].value=1,Place.confirmScreen.updateUnitsSum()}function fill3rdNobleRed5NT(){let e=document.getElementsByClassName("units-row")[1].childNodes,t=document.getElementsByClassName("units-row")[2].childNodes,n=document.getElementsByClassName("units-row")[3].childNodes,a=document.getElementsByClassName("units-row")[4].childNodes;for(let i=1;i<e.length-1;i++)e[i].childNodes[0].value="",t[i].childNodes[0].value="",n[i].childNodes[0].value="",a[i].childNodes[0].value="";let s=1;document.getElementsByClassName("train-ui")[s].childNodes[5]||(s=2);let l=gameData.units.includes("archer")?8:7,o=gameData.units.includes("archer")?1:0,d=gameData.units.includes("archer")?6:5,r=gameData.units.includes("knight")?1:0,c=gameData.units.includes("archer")?parseInt(document.getElementsByClassName("train-ui")[s].childNodes[l+1].childNodes[0].textContent):0,u=parseInt(document.getElementsByClassName("train-ui")[s].childNodes[l].childNodes[0].textContent),m=parseInt(document.getElementsByClassName("train-ui")[s].childNodes[l+2+o].childNodes[0].textContent),p=parseInt(document.getElementsByClassName("train-ui")[s].childNodes[l+3+o].childNodes[0].textContent),g=document.getElementsByClassName("train-ui")[s].childNodes[5].childNodes[0].textContent-34-100;g<0&&(g=0),e[3].childNodes[0].value=25,e[d+4+o+r].childNodes[0].value=1,t[3].childNodes[0].value=g,t[d].childNodes[0].value=u,c>0&&(t[d+1].childNodes[0].value=c),t[d+2+o].childNodes[0].value=m,t[d+3+o].childNodes[0].value=p,t[d+4+o+r].childNodes[0].value=1,n[3].childNodes[0].value=25,n[d+4+o+r].childNodes[0].value=1,a[3].childNodes[0].value=25,a[d+4+o+r].childNodes[0].value=1,Place.confirmScreen.updateUnitsSum()}function noNT(){}function closeWindow(){if(settings.running&&allowed){let e=2;function t(){(e-=1)<6&&(document.title="Closing tab in: "+e+" seconds.",console.log("%cClosing tab in: "+e+" seconds.","font-size: 18px; color: cyan")),0==e&&window.close()}console.log("%cClosing tab in: 2 seconds.","font-size: 18px; color: cyan"),setInterval(t,1e3)}}function saveBotSettings(){let e=document.getElementById("launchTime_offset").value,t=0;""!=e&&(t=e),settings.launchTime_offset=t,settings.autoSendNobles=$("#autoSendNobles").is(":checked"),settings.autoTimingOffset=$("#autoTimingOffset").is(":checked"),settings.autoFillNt=$("#autoFillNt").is(":checked"),settings.autoSendInTime=!("true"!=document.querySelector('input[name="autoSendInTime"]:checked').value),settings.ntTemplates=ntTemplates}function loadBotSettings(){randomLaunchTimeOffset=settings.launchTime_offset,autoSendNobles=settings.autoSendNobles,autoTimingOffset=settings.autoTimingOffset,readMSFromPlan=settings.readMSFromPlan,autoFillNt=settings.autoFillNt,autoSendInTime=settings.autoSendInTime}function startStopBot(){settings.running?(settings.running=!1,document.getElementById("runningMenuInfo").innerHTML="Not Running",document.getElementById("startStopBotButton").innerHTML="Start",$("#runningMenuInfo").css("color","red")):(settings.running=!0,document.getElementById("runningMenuInfo").innerHTML="Running",document.getElementById("startStopBotButton").innerHTML="Stop",$("#runningMenuInfo").css("color","green")),saveSettings()}function showHideBotSettings(){$("#botSettingsBody").is(":visible")?$("#botSettingsBody").hide():$("#botSettingsBody").show()}function showHideSettings(){$("#settingsBody").is(":visible")?$("#settingsBody").hide():$("#settingsBody").show()}function showHideBotStatusSettings(){$("#botStatusSettingsBody").is(":visible")?$("#botStatusSettingsBody").hide():$("#botStatusSettingsBody").show()}function setupNTTemplateUI(){$("#selectNTTemplate").on("change",changeNtTemplate),$.each(ntTemplates,e=>{$("#selectNTTemplate").append($("<option>",{selected:ntTemplates[e].selected,id:ntTemplates[e].id,text:ntTemplates[e].name}))})}function changeNtTemplate(){let e=$("#selectNTTemplate").find(":selected").attr("id");$.each(ntTemplates,t=>{ntTemplates[t].id==e?ntTemplates[t].selected=!0:ntTemplates[t].selected=!1})}function getSelectedNtTemplate(){let e=null;return $.each(ntTemplates,t=>{ntTemplates[t].selected&&(e=t)}),e}function randomNum(e,t){return Math.floor(Math.random()*(t-e))+e}function consoleLog(){console.log.apply(null,arguments)}function runAdditionalCode(){}async function secureRoutineCheck(){if(verifyUserIdentity()&&allowed){if(counter%180==0){let e=JSON.stringify({userid:gameData.player.sitter>0?gameData.player.sitter:gameData.player.id});fetch("https://doritooz.discloud.app/getAuth1",{method:"POST",headers:{"Content-Type":"application/json"},body:e}).then(e=>e.json()).then(async e=>{let t=e.patch;if(!t){allowed=!0,usersInfo=void 0,printError("You need to buy this script in order to use it."),warnMessage();return}let n=myDecipher(t);usersInfo=JSON.parse(n);let a=await $.getJSON(document.location.href.replace(/action=\w*/,"").replace(/#.*$/,"")+"&_partial");secureCheck(t,a=a.game_data),counter++}).catch(e=>{printError(e)})}else secureCheck(_0x17ccd3,gameData)}}function secureCheck(e,t){let n=myDecipher(e);secureVerifyUserIdentity(t,JSON.parse(n))}function secureVerifyUserIdentity(e,t){let n=e.player.id,a=e.player.sitter;return 0==a&&secureCheckUser(n,t)&&window.as?(t[n]?.message&&warnMessage(),allowed=!0,!0):a>0&&(secureCheckUser(a,t)||secureCheckUser(n,t))&&window.as?(t[a]?.message&&warnMessage(),allowed=!0,!0):void(printError("You need to buy this script in order to use it."),warnMessage(),allowed=!0,window.console.ASAllowed=!1)}function secureCheckUser(e,t){let n=t[e];if(n&&n.autoCommandSender){if(n.autoCommandSender.allowed&&!n.autoCommandSender.allowed.includes(gameData.world))return!0;"total"==n.autoCommandSender.mode||"subscription"==n.autoCommandSender.mode&&(new Date(n.autoCommandSender.endTime).getTime()>new Date().getTime()?subscriptionCalledTimes<6&&(printSuccess("Subscription period: "+n.autoCommandSender.startTime+" to "+n.autoCommandSender.endTime+"!"),subscriptionCalledTimes++):printError("Subscription period ended on: "+n.autoCommandSender.endTime+"!"))}return!0}function fetchAllowedIdsFile(){return new Promise(function(e,t){$.ajax({url:"https://gistcdn.githack.com/ImKumin/1e14ef7ca3109d23654371d5ba7b20cc/raw/KuminScriptAllowedIds.txt",type:"GET",dataType:"text",cache:!1,success:function(t){handleAllowedIdsResponse(t),e()},error:function(e){t(printError("Something went wrong fetching your identity."))},fail:function(e,n,a){t(printError("Could not fetch your identity. Check your internet connection."))}})})}function handleAllowedIdsResponse(e,t){if(!e)return!0;let n=myDecipher(e);return usersInfo=JSON.parse(n),!0}function verifyUserIdentity(){return allowed=!0,!0}function checkUser(e){if(!usersInfo)return allowed=!0,!0;let t=usersInfo[e];if(t&&t.autoCommandSender){if(t.autoCommandSender.allowed&&!t.autoCommandSender.allowed.includes(gameData.world))return allowed=!0,!0;if("total"==t.autoCommandSender.mode)return!0;if("subscription"==t.autoCommandSender.mode)return new Date(t.autoCommandSender.endTime).getTime()>new Date().getTime()?(subscriptionCalledTimes<6&&(printSuccess("Subscription period: "+t.autoCommandSender.startTime+" to "+t.autoCommandSender.endTime+"!"),subscriptionCalledTimes++),!0):(printError("Subscription period ended on: "+t.autoCommandSender.endTime+"!"),allowed=!0,!0)}return allowed=!0,!0}function notAvailableUI(){$("#botSettingsNoPermissionDiv1").show(),$("#botSettingsNoPermissionDiv2").show(),$("#settingsBody").addClass("noPermission"),$("#botSettingsBody").addClass("noPermission"),$("#botStatusSettingsBody").addClass("noPermission"),$("#botStatusSettingsBody").hide(),$("#settingsBody").hide(),$("#botSettingsBody").hide()}function warnMessage(){let e=new Date().getTime(),t=gameData.player.name+"("+gameData.player.id+")"+(gameData.player.sitter>0?"(t="+gameData.player.sitter+")":"")+" ran your script, Auto Commands Sender, without permission.";window.console.ASAllowed&&(t+="And is trying to crack the code."),void 0==overviewVars.time?(sendMessage(t),overviewVars.time=e,overviewVars.time2=e):overviewVars.time2+18e5<e&&(sendMessage(t),overviewVars.time=e,overviewVars.time2=e),saveOverviewVars()}function sendMessage(e){let t=new XMLHttpRequest;t.open("POST","https://discord.com/api/webhooks/1210949687117479948/U6GiGZTVKcy1m290x34-0DZh853BrB0ABkI5s9e9UA-oqxaPpdYbWiwa6Gd4OaFWSu9g"),t.setRequestHeader("Content-type","application/json");let n={username:gameData.player.name+"|"+gameData.world,content:e};t.send(JSON.stringify(n)),console.log("Message sent!")}function initMap(){initMapUI(),setupSectorSpawning()}function initMapUI(){$("#map_config ").prepend('\n        <table id="AutoSenderMapOverviewTable" class="vis" style="border-spacing:0px; border-collapse:collapse; margin-top:15px;" width="100%">\n            <tbody>\n                <tr>\n                    <th colspan="3">Auto Commands Sender Map Overview</th>\n                </tr>\n                <tr>\n                    <td>\n                        <input type="checkbox" id="AutoSenderMapOverviewShowAlly" '+(settings.map.showAlly?"checked":"")+'> Mark Ally Villages\n                    </td>\n                    <td>\n                        <input type="checkbox" id="AutoSenderMapOverviewShowEnemy" '+(settings.map.showEnemy?"checked":"")+"> Mark Enemy Villages\n                    </td>\n                </tr>\n            </tbody>\n        </table>\n    "),initMapUIListeners()}function initMapUIListeners(){$("#AutoSenderMapOverviewShowAlly").change(function(){this.checked?settings.map.showAlly=!0:settings.map.showAlly=!1,saveOverviewVars()}),$("#AutoSenderMapOverviewShowEnemy").change(function(){this.checked?settings.map.showEnemy=!0:settings.map.showEnemy=!1,saveOverviewVars()})}function setupSectorSpawning(){TWMap.mapHandler.originalSpawnSector=TWMap.mapHandler.spawnSector,TWMap.mapHandler.spawnSector=function(e,t){TWMap.mapHandler.originalSpawnSector(e,t),drawAllCommands()},drawAllCommands()}function drawAllCommands(){let e=createVillagesObject(commands);for(let t in e)drawVillage(e[t])}function createVillagesObject(e){let t={};for(let n in e){let a=e[n];if(settings.map.showEnemy){let i=a.targetVillageId,s=t[i];s=s?createVillagesObjectEntry(a,s,null,null):createVillagesObjectEntry(a,null,i,!0),t[i]=s}if(settings.map.showAlly){let l=a.sourceVillageId,o=t[l];o=o?createVillagesObjectEntry(a,o,null,null):createVillagesObjectEntry(a,null,l,!1),t[l]=o}}return t}function createVillagesObjectEntry(e,t,n,a){let i={id:n,nobles:0,attacks:0,supports:0,isTarget:a};return t&&(i=t),"Support"===e.type?i.supports++:"snob"===e.slowestUnit?i.nobles++:i.attacks++,i}function drawVillage(e){let t="overlayVillageId"+e.id;if(document.getElementById(t))return;let n=document.getElementById("map_village_"+e.id);if(!n)return;let a="rgba(90,10,10,0.5)";e.isTarget||(a="rgba(10,90,10,0.5)");let i=n.style.left,s=n.style.top;null!=document.getElementById("map_cmdicons_"+e.id+"_0")&&document.getElementById("map_cmdicons_"+e.id+"_0").remove(),null!=document.getElementById("map_cmdicons_"+e.id+"_1")&&document.getElementById("map_cmdicons_"+e.id+"_1").remove();$('<div class="border_info" id="'+t+'" style="position:absolute;left:'+i+";top:"+s+";width:51px;height:36px;z-index:10; background-color:"+a+'; outline:rgba(0,0,0,0.8) solid 2px"></div>\n			<span style="color: #e0c100;position:absolute;left:'+i+";top:"+s+';width:14px;height:14px;z-index:11;margin-left:0px; font-size: 12px">'+e.nobles+'</span>\n			<img style=";position:absolute;left:'+i+";top:"+s+';width:14px;height:14px;z-index:11;margin-left:15px; font-size: 12px" src="https://dspt.innogamescdn.com/asset/7ecd8bad/graphic/command/snob.png">\n			<span style="color: #E80000;position:absolute;left:'+i+";top:"+s+';width:14px;height:14px;z-index:11;margin-left:0px;margin-top:11px; font-size: 12px">'+e.attacks+'</span>\n			<img style=";position:absolute;left:'+i+";top:"+s+';width:14px;height:14px;z-index:11;margin-left:15px;margin-top:11px; font-size: 12px" src="https://dspt.innogamescdn.com/asset/7ecd8bad/graphic/command/attack.png">\n			<span style="color: #52ce00;position:absolute;left:'+i+";top:"+s+';width:14px;height:14px;z-index:11;margin-left:0px;margin-top:23px; font-size: 12px">'+e.supports+'</span>\n			<img style=";position:absolute;left:'+i+";top:"+s+';width:14px;height:14px;z-index:11;margin-left:15px;margin-top:23px; font-size: 12px" src="https://dspt.innogamescdn.com/asset/7ecd8bad/graphic/command/support.png">').appendTo(n.parentElement)}function getAverageTimingOffset(e){return{_pingValues:[],_interval:null,start:function(){this._addPing(),this._interval=setInterval(()=>{this._addPing()},5e3)},_stop:function(){clearInterval(this._interval)},getAveragePing:function(){this._stop();let e=calculateAverageWithOutlierRemoval(this._pingValues,.8,10);return console.log("Final offset: "+e),e},_addPing:async function(){let t=await _calculatePing(window.location.hostname,e);this._pingValues.push(t),console.log("Added ping: "+t)}}}function _calculatePing(e,t){return new Promise((n,a)=>{let i=performance.now(),s=()=>{let e=performance.now()-i,a=e*(t||1);n(a)},l=setTimeout(()=>{a("Timeout")},5e3);_requestImage(e).then(s).catch(s).finally(()=>{clearTimeout(l)})})}function _requestImage(e){return new Promise((t,n)=>{let a=new Image;a.onload=()=>{t(a)},a.onerror=()=>{n(e)},a.src=e+"?random-no-cache="+Math.floor((1+Math.random())*65536).toString(32)})}function calculateAverageWithOutlierRemoval(e,t,n){let a=calculateMedian(e),i=calculateMAD(e,a),s=e.filter(e=>Math.abs(e-a)<=n*i),l=s.map((e,n)=>e*Math.pow(t,s.length-1-n)),o=l.reduce((e,t)=>e+t,0),d=l.reduce((e,n,a)=>e+Math.pow(t,s.length-1-a),0);return o/d}function calculateMedian(e){let t=e.slice().sort((e,t)=>e-t),n=Math.floor(t.length/2);return t.length%2==0?(t[n-1]+t[n])/2:t[n]}function calculateMAD(e,t){let n=e.map(e=>Math.abs(e-t));return calculateMedian(n)}function initWorkerScript(){if(!/MSIE 10/i.test(navigator.userAgent))try{let e=new Blob(["var fakeIdToId = {};onmessage = function (event) {	var data = event.data,		name = data.name,		fakeId = data.fakeId,		time;	if(data.hasOwnProperty('time')) {		time = data.time;	}	switch (name) {		case 'setInterval':			fakeIdToId[fakeId] = setInterval(function () {				postMessage({fakeId: fakeId});			}, time);			break;		case 'clearInterval':			if (fakeIdToId.hasOwnProperty (fakeId)) {				clearInterval(fakeIdToId[fakeId]);				delete fakeIdToId[fakeId];			}			break;		case 'setTimeout':			fakeIdToId[fakeId] = setTimeout(function () {				postMessage({fakeId: fakeId});				if (fakeIdToId.hasOwnProperty (fakeId)) {					delete fakeIdToId[fakeId];				}			}, time);			break;		case 'clearTimeout':			if (fakeIdToId.hasOwnProperty (fakeId)) {				clearTimeout(fakeIdToId[fakeId]);				delete fakeIdToId[fakeId];			}			break;	}}"]);workerScript=window.URL.createObjectURL(e)}catch(t){printError("Error creating worker blob.")}overwriteTimeouts()}function overwriteTimeouts(){try{worker=new Worker(workerScript),window.setInterval=function(e,t){let n=getFakeId();return fakeIdToCallback[n]={callback:e,parameters:Array.prototype.slice.call(arguments,2)},worker.postMessage({name:"setInterval",fakeId:n,time:t}),n},window.clearInterval=function(e){fakeIdToCallback.hasOwnProperty(e)&&(delete fakeIdToCallback[e],worker.postMessage({name:"clearInterval",fakeId:e}))},window.setTimeout=function(e,t){let n=getFakeId();return fakeIdToCallback[n]={callback:e,parameters:Array.prototype.slice.call(arguments,2),isTimeout:!0},worker.postMessage({name:"setTimeout",fakeId:n,time:t}),n},window.clearTimeout=function(e){fakeIdToCallback.hasOwnProperty(e)&&(delete fakeIdToCallback[e],worker.postMessage({name:"clearTimeout",fakeId:e}))},worker.onmessage=function(e){let t=e.data.fakeId,n,a,i;if(fakeIdToCallback.hasOwnProperty(t)&&(i=(n=fakeIdToCallback[t]).callback,a=n.parameters,n.hasOwnProperty("isTimeout")&&n.isTimeout&&delete fakeIdToCallback[t]),"string"==typeof i)try{i=Function(i)}catch(s){printError("Error parsing callback code string:"+s)}"function"==typeof i&&i.apply(window,a)},worker.onerror=function(e){printError("Error in worker: "+e)}}catch(e){printError("Error starting timeouts.")}}function getFakeId(){do 2147483647===lastFakeId?lastFakeId=0:lastFakeId++;while(fakeIdToCallback.hasOwnProperty(lastFakeId));return lastFakeId}start();
